Компьютерные сети и интернет
============================

## Основные понятия

**Интернет** - это компьютерная сеть, которая связывает **хосты**, **конечные системы** между собой.

**Конечные системы** соединяются вместе с помощью сети **линий связи** и **коммутаторов пакетов**.

**Скорость передачи линии** измеряется в битах в секунду (бит/c).

Коммутатор пакетов получает пакет по одной из своих входных линий связи и направляет его по одной из своих исходящих линий связи. Подразделяются на:
- **маршрктизаторы**;
- **коммутаторы канального уровня**.

Последовательность линий связи и коммутаторов пакетов, через которые проходит пакет из отправляющей конечной системы в принимающую, называется **маршрутом** или **путем** в сети.

**Интернет-провайдеры** (Internet Service Providers, ISP) - дают конечным системам доступ в Интренет.

Конечные системы, коммутаторы пакетов и другие части Интернета выполняют **протоколы**, которые управляют передачей и получением информации в Интернете. Основные протоколы в Интернете:
- **протокол управления передачей** (Transmission Control Protocol, TCP);
- **протокол Интернета** (Internet Protocol, IP).

**Протокол** определяет формат и порядок сообщений, которыми обмениваются два или более взаимодействующих объектов, а также действия, предпринимаемые при передаче и/или приеме сообщения либо при возникновении другого события.

## Сети доступа

**Абонентская цифровая линия** (digital subscriber line, DSL) - игнал передается с помощью кабельной телефонной инфраструктуры. Скорости передачи данных:
- 12 Мбит/с на входе и 1,8 Мбит/с на выходе;
- 24 Мбит/с на входе и 2,5 Мбит/с на выходе.

**Кабельный доступ** - сигнал передается с помощью кабельной телевизионной инфраструктуры. Является совместным средсвом вещания. Скорости передачи данных:
- 42,8 Мбит/с на входе и 30,7 Мбит/с на выходе.

**Оптоволоконная линия** - сигнал передается с помощью волоконно-оптического соединения от центрального офиса напрямую в дом. Скорости передачи данных:
- от 51,8 Мбит/с до 39,8 Гбит/с.

**Спутниковый канал** - сигнал передается с помощью радио.

### Физическая среда

Подразделяется на:
- **проводную**:
    - **медная витая пара** - состоит из двух изолированных медных проводов, каждый из которых имеет толщину около 1 мм, заключенных в обычную спиральную оболочку. Провода переплетены друг с другом для уменьшения электрических помех, идущих от находящихся рядом проводов. Обычно несколько пар проводов объединяют вместе в один кабель и помещают их в защитный экран.
    - **коаксиальный кабель** - состоит из двух медных проводников, только эти проводники расположены не параллельно, а концентрически (или коаксиально).
    - **оптоволоконный кабель** - это тонкий, гибкий кабель, по которому распространяются световые импульсы, представляющие собой биты информации.
- **беспроводную**:
    - **наземные радиоканалы** - сигналы передаются посредством электромагнитных волн радиодиапазона.
    - **спутниковые радиоканалы** - соединяет два или более наземных приемопередатчика сверхвысокочастотного (СВЧ) диапазона (наземные станции). Спутник принимает сигнал на одной полосе частот, восстанавливает его с использованием ретранслятора и передает на другой частоте.

## Ядро сети

Конечные системы обмениваются друг с другом **сообщениями**, используя сетевые приложения. Сообщения разбиваются на более мелкие порции данных - **пакеты**.

Пакеты передаются по каждой линии связи с максимальной скоростью, которую может обеспечить данная линия. Поэтому, если исходная конечная система либо коммутатор отсылает пакет длиной `L` бит через соединение со скоростью `R` бит/с, то время передачи пакета равно `L/R` секунд.

**Передача с промежуточным накоплением** - означает, что коммутатор пакетов должен сначала принять пакет целиком перед тем, как он начнет передавать в выходную линию связи его первый бит. Чем больше комутаторов с промежуточным накоплением, тем вышезадержка: `d = N * L/R`, где `N` - количество соединений.

У каждого комутатора есть **выходной буфер** (выходая очередь) в котором хранятся пакеты для отправки в данную линию связи. Если, например, прибывающий пакет нужно отправить в линию связи, но она занята передачей другого пакета, то прибывающий пакет должен встать в очередь в выходном буфере.

Пакеты, вставая в очередь, испытывают задержки ожидания - **задержку накопления**. Когда выходной буфер полностью заполнен прибывшими пакетами, а пакеты все поступают и поступают, то происходит **потеря пакетов**. Отбрасывается либо один из прибывающих пакетов, либо один из тех, которые уже находятся в очереди.

Каждая конечная система в Интернете имеет свой адрес - **IP-адрес**. При передачи пакета в заголовок пакета включается IP-адрес места назначения.

У маршрутизаторов есть **таблица маршрутизации**, которая ставит в соответствие адреса места назначения (либо часть адресов места назначения) с исходящими соединениями маршрутизатора.

Подходы к методам передачи данных по сетям:
- **коммутация каналов** - ресурсы, необходимые для обеспечения взаимодействия между конечными системами (буфер, скорость передачи), резервируются на время соединения между системами. Организуется с помощью:
    - **мультиплексирования с частотным разделением** (frequency-division multiplexing, FDM) - спектр частот всей линии делится между установленными каналами, то есть каждому каналу на все время соединения отводится определенная полоса частот - ширина - **полоса пропускания**;
    - **мультиплексирования с временным разделением** (time-division multiplexing, TDM) - время разбивается на фиксированные промежутки - **кадры**, а кадры делятся на фиксированное число **слотов**, которые используются для передачи данных только для одного соединения.
- **коммутация пакетов** - ресурсы, необходимые для обеспечения взаимодействия между конечными системами (буфер, скорость передачи), не резервируются; сеанс взаимодействия использует ресурсы по запросу и как следствие может ожидать (то есть вставать в очередь) доступа к освободившемуся соединению.

**Точка присутствия** (Points of Presents или PoP) - это группа из одного или нескольких маршрутизаторов (расположенных в одном и том же месте) сети провайдера, к которым могут подключаться маршрутизаторы сети заказчика.

**Многоинтерфейсное подключение** - соединение с двумя или более провайдерами верхнего уровня.

**Пиринговое соединение** - это соединение сетей напрямую таким образом, чтобы трафик между ними не шел через промежуточные каналы связи.

**Точки обмена Интернет-трафиком** (Internet Exchange Point, IXP) - это коммутаторы, через которые провайдеры могут устанавливать пиринговое взаимодействие между собой.

**Сеть провайдеров контента** - взаимосвязаны частной сетью (TCP/IP сетью), но, которая отделена от публичного Интернета.

```
    [Провайдер 1-го уровня]----[Провайдер 1-го уровня]----[Провайдер контента]
        |      |    |               |     |                 |       |       |
        |      |    |               |     |                 |       |       |
        |      |    |               |     |                 |       |       |
        |    [IXP]  |               |     |----------------[IXP]    |       |
        |      |    |               |                       |       |       |
        |      |    |               |                       |       |       |
        |      |    |               |                       |       |       |
        |      | [Региональный провайдер]--------[Региональный провайдер]   |
        |      |        |             |                 |                   |
        |      |        |             |                 |                   |
        |      |        |             |                 |                   |
    [Сеть доступа]  [Сеть доступа]  [Сеть доступа]  [Сеть доступа]  [Сеть доступа]
```

## Задержки в сетях с коммутацией пакетов

Виды задержек на узлах:
- **задержка обработки** - это время, необходимое на проверку заголовка пакета и определение дальнейшего его маршрута - менее микросекунд;
- **задержка ожидания** - это время нахождения в очереди на передачу линии связи - от нескольких микросекунд до нескольких миллисекунд;
- **задержка передачи** - это время передачи всех битов пакета на линию связи, равна длине пакета деленная на пропускную способность сети - от нескольких микросекунд до нескольких миллисекунд;
- **задержка распространения** - это время затраченое на прохождение пути между маршрутизаторами, равна растоянию деленному на скорость распространения по линии связи - несколько миллисекунд.

В сумме дают задержку узла.

**Интенсивность трафика** - это количество пакетов умноженое на их длину и поделенное на скорость передачи по линии связи. Если эта величина больше 1, то возникает задержка, которая будет бесконечно увеличиваться. В случае приближения к 1 будет формироваться очередь.

Общая задержка будет равна сумме задержек на узлах по маршруту.

## Уровни протоколов

Каждый протокол принадлежит определнному уровню и каждый уровень предоставляет **услуги** уровню выше - это **модель обслуживания** уровня.

Уровни по стекам протоколов:
1. **Прикладной** - поддерживает сетевые приложения и их протоколы. Обслуживает множество конечных систем, которые обмениваются **сообщениями** - порциями данных.
2. **Транспортный** - осуществляет передачу сообщений прикладного уровня между конечными приложениями, с помощью протоколов **TCP** и **UDP**, которые разбавают сообщения на более короткие **сегменты** - порции данных для передачи друг другу.
3. **Сетевой** - отвечает за передачу порций данных - **дейтаграммы**, от одного хоста сети к другому по цепочке маршрутизаторов от источника к приемнику в Интернете. Обеспечивает службу для доставки сегмента транспортного уровня по адресу назначения на транспортный уровень получателя. Включает:
    - протокол **IP**, который определяет поля дейтаграмм, а также действия, которые должны производить конечные системы и маршрутизаторы с этими полями;
    - протоколы маршрутизации, которые определяют маршруты прохождения дейтаграмм между хостами-источниками и хостами-приемниками.
4. **Канальный** - обеспечивает передачу **кадров** - порции данных. Имеет множество протоколов: Ethernet, Wi-Fi и д.р.
5. **Физический** - обеспечивает передачу битов кадров. Имеет множество протоколов.

Каждый уровень добавляет **поле заголовока** к **полю данных**, которые он получил из уровня выше.

**Коммутаторы** работают с канальными и физическими уровнями, а **маршрутизаторы** еще с сетевым.

Прикладной уровень
==================

**Клиент-серверная архитектура** - это такая архитектура, в которой существует один **хост** - **сервер**, который постоянно находится в режиме онлайн и обслуживает запросы от других многочисленных хостов - **клиентов**. Сервер имеет фиксированный IP-адрес.

**Одноранговая (P2P) архитектура** - это такая архитектура, в которой применение серверов сведено до минимума или вообще до нуля и приложения используют непосредственное взаимодействие между парой соединенных хостов - **пирами** (**партнерами** или **узлами**).

Существуют также гибриды архитектур.

В контексте сеанса взаимодействия между парой процессов тот, который инициирует это взаимодействие (то есть первоначально контактирует с другим процессом в начале сеанса), обозначается как **клиентский**. Процесс, который ожидает контакта для начала сеанса, обозначается как **серверный**.

Процессы отправляют и принимают сообщения через программный интерфейс - **сокет**, который является интерфейсом между процессом приложения и протоколом транспортного уровня.

Для идентификации процесса-получателя необходим его **IP-адрес** и **номер порта**.

Протокол прикладного уровня определяет:
- Типы сообщений, которыми обмениваются процессы, например сообщения запроса или сообщения ответа;
- Синтаксис различных типов сообщений, то есть состав полей сообщения и их порядок;
- Семантика полей, то есть значение информации, содержащейся в каждом из них;
- Набор правил для определения времени и порядка передачи сообщений и получения ответов.

## HTTP

HTTP (протокол передачи гипертекста) - это протокол прикладного уровня для Всемирной паутины.

HTTP использует TCP в качестве базового транспортного протокола.

HTTP - это протокол без сохранения состояния.

**Веб-страница** (**документ**) состоит из объектов. **Объект** - это простой файл, имеющий уникальный URL-адрес, например файл формата HTML, изображение в формате JPEG, Java-апплет или видеоклип. Большинство веб-страниц состоит из базового HTML файла, который содержит ссылки на несколько объектов.

**Время оборота** (**round-trip time**, **RTT**) - это время, требуемое пакету малого размера для передачи от клиента к серверу и обратно (**время двусторонней задержки**). Из-за тройного рукопожатия TCP общее время ответа приблизительно равно удвоенному времени оборота плюс время на передачу данных.

Виды HTTP-соединений:
- **непостоянное** - когда на каждый запрос к одному серверу происходит открытие и закрытие TCP соединений;
- **постоянное** - когда все запросы к одному серверу идут последовательно через одно TCP соединение.

### Формат сообщения

#### Формат запроса

```
| метод | sp | URL | sp | версия | cr | lf |          <- строка запроса
| имя поля заголовка | sp | значение | cr | lf | < -\
|                                              | < - | - строки заголовка
| имя поля заголовка | sp | значение | cr | lf | < -/
| cr | lf |                                      <- пустая строка
|                                              | < -\
|                                              | < - | - тело сообщения
|                                              | < -/
```

#### Формат ответа

```
| версия | sp | код | sp | фраза | cr | lf |     <- строка запроса
| имя поля заголовка | sp | значение | cr | lf | < -\
|                                              | < - | - строки заголовка
| имя поля заголовка | sp | значение | cr | lf | < -/
| cr | lf |                                      <- пустая строка
|                                              | < -\
|                                              | < - | - тело сообщения
|                                              | < -/
```
