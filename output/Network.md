[Содержание](#Содержание)
==========

- [Компьютерные сети и интернет](#Компьютерные-сети-и-интернет)
    - [Основные понятия](#Основные-понятия)
    - [Сети доступа](#Сети-доступа)
        - [Физическая среда](#Физическая-среда)
    - [Ядро сети](#Ядро-сети)
    - [Задержки в сетях с коммутацией пакетов](#Задержки-в-сетях-с-коммутацией-пакетов)
    - [Уровни протоколов](#Уровни-протоколов)
- [Прикладной уровень](#Прикладной-уровень)
    - [HTTP](#HTTP)
        - [Формат сообщения](#Формат-сообщения)
            - [Формат запроса](#Формат-запроса)
            - [Формат ответа](#Формат-ответа)
    - [FTP](#FTP)
        - [Команды](#Команды)
    - [Электронная почта](#Электронная-почта)
        - [POP3](#POP3)
        - [IMAP](#IMAP)
    - [DNS](#DNS)
        - [DNS сообщения](#DNS-сообщения)
    - [Одноранговые приложения](#Одноранговые-приложения)
        - [Протокол для передачи файлов BitTorrent](#Протокол-для-передачи-файлов-BitTorrent)
        - [Распределенные хеш-таблицы (distributed hash table, DHT)](#Распределенные-хеш-таблицы-distributed-hash-table-DHT)
- [Транспортный уровень](#Транспортный-уровень)
    - [Протоколы надежной передачи данных](#Протоколы-надежной-передачи-данных)
    - [UDP](#UDP)
        - [Структура UDP-сегмента](#Структура-UDP-сегмента)
    - [TCP](#TCP)
        - [Структура TCP-сегмента](#Структура-TCP-сегмента)
        - [Время оборота](#Время-оборота)
        - [Управление потоком](#Управление-потоком)
        - [Установка соединения](#Установка-соединения)
        - [Закрытие соединения](#Закрытие-соединения)
        - [Управление перегрузкой](#Управление-перегрузкой)
- [Сетевой уровень](#Сетевой-уровень)
    - [Сети с виртуальными каналами](#Сети-с-виртуальными-каналами)
    - [Дейтаграммные сети](#Дейтаграммные-сети)
    - [Маршрутизатор](#Маршрутизатор)
    - [Протокол IP (Internet protocol)](#Протокол-IP-Internet-protocol)
        - [Дейтаграмма](#Дейтаграмма)
        - [Трансляция сетевых адресов (network address translation, NAT)](#Трансляция-сетевых-адресов-network-address-translation-NAT)
        - [Протокол управляющих сообщений Интернета (ICMP)](#Протокол-управляющих-сообщений-Интернета-ICMP)
        - [IPv6](#IPv6)
    - [Алгоритмы маршрутизации](#Алгоритмы-маршрутизации)
    - [Протоколы внутренней маршрутизации в Интернете](#Протоколы-внутренней-маршрутизации-в-Интернете)
        - [Протокол маршрутной информации (Routing Information Protocol, RIP)](#Протокол-маршрутной-информации-Routing-Information-Protocol-RIP)
        - [Открытый протокол выбора кратчайшего маршрута (Open Shortest Path First, OSPF)](#Открытый-протокол-выбора-кратчайшего-маршрута-Open-Shortest-Path-First-OSPF)
    - [Протокол граничных маршрутизаторов (BGP)](#Протокол-граничных-маршрутизаторов-BGP)
    - [Широковещательная и групповая маршрутизация](#Широковещательная-и-групповая-маршрутизация)
- [Канальный уровень](#Канальный-уровень)

<a id="Компьютерные-сети-и-интернет" href="#Компьютерные-сети-и-интернет">Компьютерные сети и интернет</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
============================

## <a id="Основные-понятия" href="#Основные-понятия">Основные понятия</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

**Интернет** - это компьютерная сеть, которая связывает **хосты**, **конечные системы** между собой.

**Конечные системы** соединяются вместе с помощью сети **линий связи** и **коммутаторов пакетов**.

**Скорость передачи линии** измеряется в битах в секунду (бит/c).

Коммутатор пакетов получает пакет по одной из своих входных линий связи и направляет его по одной из своих исходящих линий связи. Подразделяются на:
- **маршрктизаторы**;
- **коммутаторы канального уровня**.

Последовательность линий связи и коммутаторов пакетов, через которые проходит пакет из отправляющей конечной системы в принимающую, называется **маршрутом** или **путем** в сети.

**Интернет-провайдеры** (Internet Service Providers, ISP) - дают конечным системам доступ в Интренет.

Конечные системы, коммутаторы пакетов и другие части Интернета выполняют **протоколы**, которые управляют передачей и получением информации в Интернете. Основные протоколы в Интернете:
- **протокол управления передачей** (Transmission Control Protocol, TCP);
- **протокол Интернета** (Internet Protocol, IP).

**Протокол** определяет формат и порядок сообщений, которыми обмениваются два или более взаимодействующих объектов, а также действия, предпринимаемые при передаче и/или приеме сообщения либо при возникновении другого события.

## <a id="Сети-доступа" href="#Сети-доступа">Сети доступа</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

**Абонентская цифровая линия** (digital subscriber line, DSL) - сигнал передается с помощью кабельной телефонной инфраструктуры. Скорости передачи данных:
- 12 Мбит/с на входе и 1,8 Мбит/с на выходе;
- 24 Мбит/с на входе и 2,5 Мбит/с на выходе.

**Кабельный доступ** - сигнал передается с помощью кабельной телевизионной инфраструктуры. Является совместным средсвом вещания. Скорости передачи данных:
- 42,8 Мбит/с на входе и 30,7 Мбит/с на выходе.

**Оптоволоконная линия** - сигнал передается с помощью волоконно-оптического соединения от центрального офиса напрямую в дом. Скорости передачи данных:
- от 51,8 Мбит/с до 39,8 Гбит/с.

**Спутниковый канал** - сигнал передается с помощью радио.

### <a id="Физическая-среда" href="#Физическая-среда">Физическая среда</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Подразделяется на:
- **проводную**:
    - **медная витая пара** - состоит из двух изолированных медных проводов, каждый из которых имеет толщину около 1 мм, заключенных в обычную спиральную оболочку. Провода переплетены друг с другом для уменьшения электрических помех, идущих от находящихся рядом проводов. Обычно несколько пар проводов объединяют вместе в один кабель и помещают их в защитный экран.
    - **коаксиальный кабель** - состоит из двух медных проводников, только эти проводники расположены не параллельно, а концентрически (или коаксиально).
    - **оптоволоконный кабель** - это тонкий, гибкий кабель, по которому распространяются световые импульсы, представляющие собой биты информации.
- **беспроводную**:
    - **наземные радиоканалы** - сигналы передаются посредством электромагнитных волн радиодиапазона.
    - **спутниковые радиоканалы** - соединяет два или более наземных приемопередатчика сверхвысокочастотного (СВЧ) диапазона (наземные станции). Спутник принимает сигнал на одной полосе частот, восстанавливает его с использованием ретранслятора и передает на другой частоте.

## <a id="Ядро-сети" href="#Ядро-сети">Ядро сети</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Конечные системы обмениваются друг с другом **сообщениями**, используя сетевые приложения. Сообщения разбиваются на более мелкие порции данных - **пакеты**.

Пакеты передаются по каждой линии связи с максимальной скоростью, которую может обеспечить данная линия. Поэтому, если исходная конечная система либо коммутатор отсылает пакет длиной `L` бит через соединение со скоростью `R` бит/с, то время передачи пакета равно `L/R` секунд.

**Передача с промежуточным накоплением** - означает, что коммутатор пакетов должен сначала принять пакет целиком перед тем, как он начнет передавать в выходную линию связи его первый бит. Чем больше комутаторов с промежуточным накоплением, тем вышезадержка: `d = N * L/R`, где `N` - количество соединений.

У каждого комутатора есть **выходной буфер** (выходая очередь) в котором хранятся пакеты для отправки в данную линию связи. Если, например, прибывающий пакет нужно отправить в линию связи, но она занята передачей другого пакета, то прибывающий пакет должен встать в очередь в выходном буфере.

Пакеты, вставая в очередь, испытывают задержки ожидания - **задержку накопления**. Когда выходной буфер полностью заполнен прибывшими пакетами, а пакеты все поступают и поступают, то происходит **потеря пакетов**. Отбрасывается либо один из прибывающих пакетов, либо один из тех, которые уже находятся в очереди.

Каждая конечная система в Интернете имеет свой адрес - **IP-адрес**. При передачи пакета в заголовок пакета включается IP-адрес места назначения.

У маршрутизаторов есть **таблица маршрутизации**, которая ставит в соответствие адреса места назначения (либо часть адресов места назначения) с исходящими соединениями маршрутизатора.

Подходы к методам передачи данных по сетям:
- **коммутация каналов** - ресурсы, необходимые для обеспечения взаимодействия между конечными системами (буфер, скорость передачи), резервируются на время соединения между системами. Организуется с помощью:
    - **мультиплексирования с частотным разделением** (frequency-division multiplexing, FDM) - спектр частот всей линии делится между установленными каналами, то есть каждому каналу на все время соединения отводится определенная полоса частот - ширина - **полоса пропускания**;
    - **мультиплексирования с временным разделением** (time-division multiplexing, TDM) - время разбивается на фиксированные промежутки - **кадры**, а кадры делятся на фиксированное число **слотов**, которые используются для передачи данных только для одного соединения.
- **коммутация пакетов** - ресурсы, необходимые для обеспечения взаимодействия между конечными системами (буфер, скорость передачи), не резервируются; сеанс взаимодействия использует ресурсы по запросу и как следствие может ожидать (то есть вставать в очередь) доступа к освободившемуся соединению.

**Точка присутствия** (Points of Presents или PoP) - это группа из одного или нескольких маршрутизаторов (расположенных в одном и том же месте) сети провайдера, к которым могут подключаться маршрутизаторы сети заказчика.

**Многоинтерфейсное подключение** - соединение с двумя или более провайдерами верхнего уровня.

**Пиринговое соединение** - это соединение сетей напрямую таким образом, чтобы трафик между ними не шел через промежуточные каналы связи.

**Точки обмена Интернет-трафиком** (Internet Exchange Point, IXP) - это коммутаторы, через которые провайдеры могут устанавливать пиринговое взаимодействие между собой.

**Сеть провайдеров контента** - взаимосвязаны частной сетью (TCP/IP сетью), но, которая отделена от публичного Интернета.

```
    [Провайдер 1-го уровня]----[Провайдер 1-го уровня]----[Провайдер контента]
        |      |    |               |     |                 |       |       |
        |      |    |               |     |                 |       |       |
        |      |    |               |     |                 |       |       |
        |    [IXP]  |               |     |----------------[IXP]    |       |
        |      |    |               |                       |       |       |
        |      |    |               |                       |       |       |
        |      |    |               |                       |       |       |
        |      | [Региональный провайдер]--------[Региональный провайдер]   |
        |      |        |             |                 |                   |
        |      |        |             |                 |                   |
        |      |        |             |                 |                   |
    [Сеть доступа]  [Сеть доступа]  [Сеть доступа]  [Сеть доступа]  [Сеть доступа]
```

## <a id="Задержки-в-сетях-с-коммутацией-пакетов" href="#Задержки-в-сетях-с-коммутацией-пакетов">Задержки в сетях с коммутацией пакетов</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Виды задержек на узлах:
- **задержка обработки** - это время, необходимое на проверку заголовка пакета и определение дальнейшего его маршрута - менее микросекунд;
- **задержка ожидания** - это время нахождения в очереди на передачу линии связи - от нескольких микросекунд до нескольких миллисекунд;
- **задержка передачи** - это время передачи всех битов пакета на линию связи, равна длине пакета деленная на пропускную способность сети - от нескольких микросекунд до нескольких миллисекунд;
- **задержка распространения** - это время затраченое на прохождение пути между маршрутизаторами, равна растоянию деленному на скорость распространения по линии связи - несколько миллисекунд.

В сумме дают задержку узла.

**Интенсивность трафика** - это количество пакетов умноженое на их длину и поделенное на скорость передачи по линии связи. Если эта величина больше 1, то возникает задержка, которая будет бесконечно увеличиваться. В случае приближения к 1 будет формироваться очередь.

Общая задержка будет равна сумме задержек на узлах по маршруту.

## <a id="Уровни-протоколов" href="#Уровни-протоколов">Уровни протоколов</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Каждый протокол принадлежит определнному уровню и каждый уровень предоставляет **услуги** уровню выше - это **модель обслуживания** уровня.

Уровни по стекам протоколов:
1. **Прикладной** - поддерживает сетевые приложения и их протоколы. Обслуживает множество конечных систем, которые обмениваются **сообщениями** - порциями данных.
2. **Транспортный** - осуществляет передачу сообщений прикладного уровня между конечными приложениями, с помощью протоколов **TCP** и **UDP**, которые разбавают сообщения на более короткие **сегменты** - порции данных для передачи друг другу.
3. **Сетевой** - отвечает за передачу порций данных - **дейтаграммы**, от одного хоста сети к другому по цепочке маршрутизаторов от источника к приемнику в Интернете. Обеспечивает службу для доставки сегмента транспортного уровня по адресу назначения на транспортный уровень получателя. Включает:
    - протокол **IP**, который определяет поля дейтаграмм, а также действия, которые должны производить конечные системы и маршрутизаторы с этими полями;
    - протоколы маршрутизации, которые определяют маршруты прохождения дейтаграмм между хостами-источниками и хостами-приемниками.
4. **Канальный** - обеспечивает передачу **кадров** - порции данных. Имеет множество протоколов: Ethernet, Wi-Fi и д.р.
5. **Физический** - обеспечивает передачу битов кадров. Имеет множество протоколов.

Каждый уровень добавляет **поле заголовока** к **полю данных**, которые он получил из уровня выше.

**Коммутаторы** работают с канальными и физическими уровнями, а **маршрутизаторы** еще с сетевым.

<a id="Прикладной-уровень" href="#Прикладной-уровень">Прикладной уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
==================

**Клиент-серверная архитектура** - это такая архитектура, в которой существует один **хост** - **сервер**, который постоянно находится в режиме онлайн и обслуживает запросы от других многочисленных хостов - **клиентов**. Сервер имеет фиксированный IP-адрес.

**Одноранговая (P2P) архитектура** - это такая архитектура, в которой применение серверов сведено до минимума или вообще до нуля и приложения используют непосредственное взаимодействие между парой соединенных хостов - **пирами** (**партнерами** или **узлами**).

Существуют также гибриды архитектур.

В контексте сеанса взаимодействия между парой процессов тот, который инициирует это взаимодействие (то есть первоначально контактирует с другим процессом в начале сеанса), обозначается как **клиентский**. Процесс, который ожидает контакта для начала сеанса, обозначается как **серверный**.

Процессы отправляют и принимают сообщения через программный интерфейс - **сокет**, который является интерфейсом между процессом приложения и протоколом транспортного уровня.

Для протокола TCP существуют два сокета:
- **входной сокет** - является начальной точкой контакта для всех клиентов, ожидающих соелинения с сервером и используется для тройного рукопожатия;
- **сокет соединения** - создается для каждого клиента и используется для связи.

Для идентификации процесса-получателя необходим его **IP-адрес** и **номер порта**.

Протокол прикладного уровня определяет:
- Типы сообщений, которыми обмениваются процессы, например сообщения запроса или сообщения ответа;
- Синтаксис различных типов сообщений, то есть состав полей сообщения и их порядок;
- Семантика полей, то есть значение информации, содержащейся в каждом из них;
- Набор правил для определения времени и порядка передачи сообщений и получения ответов.

Виды протоколов:
- **push** - протокол отправки;
- **pull** - протокол получения.

## <a id="HTTP" href="#HTTP">HTTP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

HTTP (протокол передачи гипертекста) - это протокол прикладного уровня для Всемирной паутины.

HTTP использует TCP в качестве базового транспортного протокола.

HTTP - это протокол без сохранения состояния.

**Веб-страница** (**документ**) состоит из объектов. **Объект** - это простой файл, имеющий уникальный URL-адрес, например файл формата HTML, изображение в формате JPEG, Java-апплет или видеоклип. Большинство веб-страниц состоит из базового HTML файла, который содержит ссылки на несколько объектов.

**Время оборота** (**round-trip time**, **RTT**) - это время, требуемое пакету малого размера для передачи от клиента к серверу и обратно (**время двусторонней задержки**). Из-за тройного рукопожатия TCP общее время ответа приблизительно равно удвоенному времени оборота плюс время на передачу данных.

Виды HTTP-соединений:
- **непостоянное** - когда на каждый запрос к одному серверу происходит открытие и закрытие TCP соединений;
- **постоянное** - когда все запросы к одному серверу идут последовательно через одно TCP соединение.

### <a id="Формат-сообщения" href="#Формат-сообщения">Формат сообщения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

#### <a id="Формат-запроса" href="#Формат-запроса">Формат запроса</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

```
| метод | sp | URL | sp | версия | cr | lf |          <- строка запроса
| имя поля заголовка | sp | значение | cr | lf | < -\
|                                              | < - | - строки заголовка
| имя поля заголовка | sp | значение | cr | lf | < -/
| cr | lf |                                      <- пустая строка
|                                              | < -\
|                                              | < - | - тело сообщения
|                                              | < -/
```

#### <a id="Формат-ответа" href="#Формат-ответа">Формат ответа</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

```
| версия | sp | код | sp | фраза | cr | lf |     <- строка запроса
| имя поля заголовка | sp | значение | cr | lf | < -\
|                                              | < - | - строки заголовка
| имя поля заголовка | sp | значение | cr | lf | < -/
| cr | lf |                                      <- пустая строка
|                                              | < -\
|                                              | < - | - тело сообщения
|                                              | < -/
```

## <a id="FTP" href="#FTP">FTP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используется для передачи файлов с одного хоста на другой хост через TCP. Использует в своей работе два соединения:
- **управляющее соединение** - для передачи контрольной информации между двумя хостами по порту 21 - **вне полосы** передачи файлов;
- **соединение данных** - для передачи файлов по порту 20.

Протокол общения:
- по порту 21 устанавливается управляющее соединение с серверной стороной;
- затем передается идентификатор и пароль пользователя через управляющее соединение;
- ведется обмен командами через управляющее соединение которое остается открытым в течение всего сеанса;
- для передачи файла сервер инициирует TCP-соединение данных с клиентской стороной по порту 20 и отправляет один файл по этому соединению и закрывает его.

### <a id="Команды" href="#Команды">Команды</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Команды состоят из 4 символов в верхнем регистре и необязательых параметров, а разделяются символом возврата каретки и переводом строки.

Основные команды:
- `USER <идентификатор_пользователя>` - передает идентификатор;
- `PASS <пароль_пользователя>` - передает пароль;
- `LIST` - запрашивает список всех файлов в текущем каталоге, при этом список передается через соединение данных;
- `RETR <имя_файла>` - запрашивает файл из текущего каталога, через соединение данных;
- `STOR <имя_файла>` - отправляет файл в текущий каталог, через соединение данных.

После каждой команды сервер отправляет ответ клиенту состоящий из трехзначного числа и необязательного сообщения.

## <a id="Электронная-почта" href="#Электронная-почта">Электронная почта</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Состоит из:
- **пользовательского агента** - который позволяет создавать, прочитывать сообщения, отвечать на них, перенаправлять и сохранять - он взаимодействует с почтовым сервером;
- **почтового сервера** - на котором хранится **почтовый ящик** пользователя;
- **простого протокола передачи почты** - Simple Mail Transfer Protocol (SMTP) использует TCP.

Основной путь сообщения:
1. Создание письма в пользовательском агенте;
2. Отправка сообщения на почтовый сервер отправителя, где оно помещается в очередь с интервалами отправок раз в 30 мин;
3. Передача сообщения из почтового сервера отправителя на почтовый сервер получателя посредством протокола SMTP и порта 25;
4. Помещение письма в почтовый ящик получателя.

Пример общения SMTP-клиента (К) и SMTP-сервера (С):
```
С: 220 hamburger.edu
К: HELO crepes.fr
С: 250 Hello crepes.fr, pleased to meet you
К: MAIL FROM: <alice@crepes.fr>
С: 250 alice@crepes.fr ... Sender ok
К: RCPT TO: <bob@hamburger.edu>
С: 250 bob@hamburger.edu ... Recipient ok
К: DATA
С: 354 Enter mail, end with "." on a line by itself
К: Вы любите кетчуп?
К: Как насчет анчоусов?
К: .
С: 250 Message accepted for delivery
К: QUIT
С: 221 hamburger.edu closing connection
```

Внутри секции передачи данных после команды `DATA` может распологатся секция заголовков в формате строк `<заголовок>: <значение>`, которая отделена от основных данных пустой строкой, данный оканчиваются строкой `.`.

На каждую команду сервер выдает ответ, сопровождающийся кодом ответа и некоторым (необязательным) англоязычным объяснением.

SMTP использует постоянные соединения: если сервер-источник пытается отправить несколько сообщений одному и тому же серверу-получателю, он может направить их все через одно TCP соединение.

Для доступа к почте используются протоколы, которые передают сообщения с почтового сервера на локальные устройства:
- **POP3** (Post Office Protocol, протокол почтового отделения, версия 3);
- **IMAP** (Internet Mail Access Protocol, протокол доступа к почте через Интернет);
- **HTTP**.

### <a id="POP3" href="#POP3">POP3</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Работает по порту 110. В процессе работы проходит 3 состояния:
1. Авторизация с помощью команд:
    - `user <идентификатор>`;
    - `pass <пароль>`.
2. Транзакции для получения сообщений, отметок сообщений о удалении, снятие отметок и получение статистики с помощью команд:
    - `list` - получения списка сообщений;
    - `retr <номер>` - получение сообщения по номеру;
    - `dele <номер>` - удаление сообщения по номеру.
3. Обновление данных - удаление помеченных сообщений на сервере, после команды `quit`.

На каждую команду сервер отвечает двумя возможными ответами:
- `+OK <сообщение>` - при успешной команде;
- `-ERR <сообщение>` - при неуспешной команде.

### <a id="IMAP" href="#IMAP">IMAP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Позволяет связывать каждое сообщение с определенным каталогом. А также позволяет пользовательскому агенту получать части сообщений, например, только заголовок, либо одну из частей MIME-сообщения.

## <a id="DNS" href="#DNS">DNS</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

DNS - это система доменных имен Интернета (Domain Name System). Это распределенная БД, которая реализована с помощью иерархии DNS-серверов и протокол, который общается посредством UDP и порта 53. Позволяет по имени хоста получить его IP-адрес.

Предоставляет службы:
- **назначение псевдонимов хостам** - это когда главному - **каноническому имени хоста** назначаются псевдонимы;
- **назначение псевдонимов почтовому серверу**;
- **распределение нагрузки** - это когда по имени хоста возвращается весь набор IP-адресов и с каждым ответом делает ротацию их порядка.

Существуют классы серверов DNS:
- **корневые DNS-серверы** - хранят список IP-адресов для DNS-серверов верхнего уровня;
- **DNS-серверы верхнего уровня** - отвечают за домены верхнего уровня (`org`, `net`, `edu`) и национальные домены верхнего уровня (`uk`, `fr`, `ca`, `jp`, `ru`) - хранят список IP-адресов для авторитетных DNS-серверов;
- **авторитетные DNS-серверы** (ответственные за свою зону `amazon.com`, `poly.edu`) - хранят список IP-адресов для хостов;
- **локальный DNS-сервер** - который находится у провайдера верхнего или нижнего уровня и производит общение с серверами выше для выяснения IP-адреса для хоста.

**Рекурсивный запрос** - это когда сервер получает информацию по поручению другого сервера, а **итеративный** - это когда сервер сам напрямую общается с другими серверами.

**DNS-кэширование** - это когда происходит кэширование записей на срок около 2 дней, для того чтобы уменьшить количество обращений на другие сервера.

Серверы DNS хранят **ресурсные записи** в виде набора из четырех полей:
- **имя** - зависит от типа;
- **значение** - зависит от типа;
- **тип**:
    - `A` - это запись преобразования имени в IP-адрес, где **имя** - имя хоста, а **значение** - IP-адрес хоста:
        > `(relay1.bar.foo.com, 145.37.93.126, A)`
    - `NS` - это запись соответствия значения домена и авторитетного сервера, где **имя** - домен, а **значение** - имя хоста авторитетного DNS-сервера, который отвечает за получение IP-адресов соответствующего домена:
        > `(foo.com, dns.foo.com, NS)`
    - `CNAME` - это запись соответствия канонического имени для псевдонима, где **имя** - псевдоним, а **значение** - каноническое имя:
        > `(foo.com, relay1.bar.foo.com, CNAME)`
    - `MX` - это запись соответствия канонического имени почтового сервера для псевдонима, где **имя** - псевдоним, а **значение** - каноническое имя почтового сервера:
        > `(foo.com, mail.bar.foo.com, MX)`
- **время жизни**.

Если DNS-сервер не является авторитетным для какого-то определенного имени хоста, то он будет содержать запись типа `NS` для домена, который включает это имя хоста, а также запись типа `A`, в которой находится IP-адрес DNS-сервера, содержащегося в поле **значение** записи типа `NS`.

### <a id="DNS-сообщения" href="#DNS-сообщения">DNS сообщения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используются для запросов и ответов и имеют одинаковый формат:
1. **Секция заголовков** - 12 байт:
    1. **Идентификатор запроса** - 16-разрядное число;
    2. **Флаги** - 16 бит:
        1. Однобитный флаг запрос / ответ:
            - `0` - запрос;
            - `1` - ответ.
        2. Однобитный флаг авторитетного ответа:
            - `0` - не является;
            - `1` - DNS сервер является авторитетным для запрашиваемого хоста.
        3. Однобитный флаг запроса рекурсии:
            - `0` - не требует;
            - `1` - требует от сервера обработать этот запрос самому.
        4. Однобитный флаг ответа возможности рекурсии:
            - `0` - не возможна;
            - `1` - рекурсия возможна.
    3. **Число вопросов** - 16-разрядное число;
    4. **Число ответных ресурсных записей** - 16-разрядное число;
    5. **Число ответных ресурсных записей авторитетного источника** - 16-разрядное число;
    6. **Число дополнительных ресурсных записей** - 16-разрядное число;
2. **Секция вопросов** - переменное количество - содержит информацию о выполняемом запросе, которая включает, поле имени, содержащее запрашиваемое имя хоста, и поле типа, которое указывает тип запроса: адрес, связанный с именем (тип А) или имя почтового сервера (тип MX);
3. **Секция ответов** - переменное количество - содержит ресурсные записи для запрашиваемых имен;
4. **Секция имен** - переменное количество - содержит ресурсные записи других авторитетных серверов;
5. **Секция дополнительной информации** - переменное количество - содержит другие полезные ресурсные записи.

## <a id="Одноранговые-приложения" href="#Одноранговые-приложения">Одноранговые приложения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

### <a id="Протокол-для-передачи-файлов-BitTorrent" href="#Протокол-для-передачи-файлов-BitTorrent">Протокол для передачи файлов BitTorrent</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Набор всер пиров, участвующих в раздаче конкретного файла, называется **торрентом**. Пиры в торренте обмениваются друг с другом **кусками** (сегментами) файла равной длины - 256 кбит. Когда пир впервые присоединяется к торренту, он не имеет сегментов. С течением времени он собирает их больше и больше. Во время загрузки сегментов он может одновременно выгружать их, отдавая другим узлам.

Каждый торрент имеет инфраструктурный узел, называемый **трекером**. Когда пир присоединяется к торренту, он регистрируется на трекере и периодически информирует его о своем присутствии в раздаче. Трекер отслеживает пиров-участников торрента.

При присоединении к торренту, трекер случайным образом выбирает последовательность пиров (в районе 50 штук) из набора участвующих в раздаче и отправляет их IP-адреса. Обладая списком этих пиров, участник пытается установить параллельные TCP-соединения со всеми членами этого списка - соседями. Со временем количество узлов может изменяться - из него могут пропадать участники или добавляться.

В конкретный момент времени каждый пир имеет у себя определенный набор сегментов раздаваемого файла, а остальные пиры - другие наборы сегментов. Участник переодически запрашивает у своих соседей (через TCP-соединения) список сегментов, которыми они владеют. На основании этих списков будут запрашиваться (через TCP-соединения) сегменты, которых нет. Вначале запрашиваются **редкие сегменты** для того чтобы число копий каждого сегмента в торренте приблизительно уравнивалось.

Для обмена сегментами используется **алгоритм торговли** - для каждого из своих соседей участник постоянно измеряет скорость получения от них данных и определяет четырех пиров, которые снабжают его на самой высокой скорости, этот участник отвечает им взаимностью и отправляет сегменты этим четырем пирам - они становятся **разблокированными**. Каждые 10 секунд эти скорости пересчитываются, и, возможно, четверка лидирующих узлов меняется. Каждые 30 секунд участник случайным образом выбирает дополнительного соседа и отправляет ему сегменты файла, он становится **оптимистически разблокирован**. Все другие соседние пиры за пределами этой пятерки (четыре топ-узла и один случайный) **блокируются** (удушаются), то есть они не получают никаких сегментов от участника.

### <a id="Распределенные-хеш-таблицы-distributed-hash-table-DHT" href="#Распределенные-хеш-таблицы-distributed-hash-table-DHT">Распределенные хеш-таблицы (distributed hash table, DHT)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Каждый узел в системе распределенной БД будет хранить только небольшую часть всех пар ключ, значение. При этом каждый узел может запрос к системе с конкретным ключом, после чего та определяет узлы, которые содержат соответствующую пару ключ, значение и возвращает эту возвращает пару запрашивающему узлу. Также любой узел может добавлять новую пару ключ, значение в БД.

В основе лежит количество пользователей с идентификаторами в диапазоне `[0, 2^n - 1]` для некоторого фиксированного `n` и хеш функция, которая ставит в соответствие каждому ключу, целое число в диапазоне `[0, 2^n - 1]`.

При добавлении пары ключ, значение она добавляется в **ближайший следующий ключ** - пира, так как не всегда есть все пиры. Если ключ точно равен одному из идентификаторов, то сохраняют пару ключ, значение в узле с этим идентификатором; а если ключ больше чем все идентификаторы, то используют правило сохранения в узле с наименьшим идентификатором.

Для поиска используется кроуговое размещение пиров, в котором они знают информацию только о ближайших соседях и некоторых ссылок на другие узлы, это делается с помощью особого случая **оверлейной (наложенной) сети**, где узлы формируют логическую сеть, которая расположена как бы поверх компьютерной сети. Каналами связи в оверлейных сетях являются не физические, а виртуальные каналы между парами узлов. Каждый пир передает информацию соседям о поиске, если он не отвечает за этот идентификатор, а если отвечает, то отправляет сообщение обратно запрашивающему пиру что он отвечает за этот идентификатор.

Каждый пир переодически опрашивает своих соседий на то что они живы с помощью эхо-сообщений и проверкой ответа. В случае если он не отвечает, то он обновляет информацию о своих последователях, запрашивая информацию о последователях своих последователей.

При подключении пира к сети он опрашивает корневой идентификатор о том, кто является его последователем и предшественником, и это сообщение отправляется по сети в поисках пиров, которые являются последователсями и предшественниками. А затем менет их последователей и предшественников на себя.

<a id="Транспортный-уровень" href="#Транспортный-уровень">Транспортный уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
====================

Обеспечивает **логическое соединение** между прикладными процессами, выполняющимися на разных хостах - создание канала, непосредственно соединяющий процессы разных хостов. Обмениваются **сегментами**.

Основные протоколы:
- **UDP** (User Datagram Protocol, Протокол пользовательских дейтаграмм), который предоставляет ненадежную службу передачи данных без установления логического соединения для связи приложений.
- **TCP** (Transmission Control Protocol, протокол управления передачей), обеспечивающий службу надежной передачи данных с установлением соединения для связи между приложениями.

**Демультиплексирование** - это работа по доставке данных сегмента транспортного уровня нужному, соответствующему сокету на основании специальных полей сегмента.

**Мультиплексирование** - это сбор фрагментов данных, поступающих на транспортный уровень хоста-отправителя из различных сокетов, создание сегментов путем присоединения заголовка к каждому фрагменту и передача сегментов сетевому уровню.

**Специальные поля** сегментов - это 16-разрядные числа (0 - 65535): номер порта отправителя и номер порта получателся.

## <a id="Протоколы-надежной-передачи-данных" href="#Протоколы-надежной-передачи-данных">Протоколы надежной передачи данных</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Обладают механизмом многократного повторения передачи, и называются протоколами с **автоматическим запросом повторной передачи** (Automatic Repeat reQuest, ARQ) и обладают механизмами:
- **обнаружения ошибки** в данных;
- **обратной связи с передающей стороной** для отправки уведомлений положительных (ACK) или отрицательных (NAK) квитанций о получении сообщения;
- **повторная передача** пакета.

Протоколы с ожиданием ответа квитанции и не возможностью принимать данные от верхнего уровня до прихода положительной квитанции называются **протоколами с ожиданием подтверждений** (stop-and-wait).

Для контроля порядка пакетов и избежания **дублирования пакетов** в них добавляется поле, содержащее **порядковый номер** пакета. Если порядковый номер представляет из себя чередование 0 или 1, то это протокол с чередованием битов.

Для контролирования потери пакета используется **таймер отсчета** после отправки пакета, который позволяет определить окончание интервала ожидания.

**Конвейризация** в протоколах позволяет ускорить передачу данных. Тогда для исправления ошибок будут использоваться методы:
- **возвращение на N пакетов назад** (Go-Back-N (GBN)) - в нем максимальное число неподтвержденных пакетов не должно превышать числа N. Сам механизм работает в виде скользящего окна по очереди пакетов для отправки и ожидания подтверждения и сдвигается от последнего пакета с успешной квитанцией. Он ждет получения успешных квитанций для отправки последующих пакетов, если они превышают N. В случае заполнености очереди данные возвращаются верхнему уровню с сообщением о заполнености окна. На ответ приходит общая квитанция для пакета **n** указывающая на то, что все пакеты с порядковыми номерами, предшествующими **n**, успешно приняты. Получатель при этом принимает все пакеты только в порядке следования и не принимает пакеты в неверном формате и всегда отправляет ACK последнего пакета в верном порядке. Отправитель ждет определенный интервал времени для повторной отправки всех пакетов из окна без ACK.
```
[ пакет с ACK                           ]
[ пакет с ACK                           ]
[ отправленный пакет без ACK            ] <--
[ отправленный пакет без ACK            ]   |
[ отправленный пакет без ACK            ]   |- размер окна N
[ готовый, но еше не отправленный пакет ]   |
[ готовый, но еше не отправленный пакет ] <--
[ не готовый пакет                      ]
[ не готовый пакет                      ]
[ не готовый пакет                      ]
```
- **выборочное повторение** (протокол SR) - аналогично протоколу GBN, только при этом в окне могут содержаться уже переданные пакеты. Принимающая сторона выдает квитанцию каждому принятому правильному (не содержащему ошибок) пакету, независимо от того, нарушает он порядок следования или нет и хранит их в буффере до момента получения всех пакетов в правильном порядке и передачи их партии на уровень выше. Подтверждения на получения пакетов отправляются всегда.
```
[ пакет с ACK                           ]
[ пакет с ACK                           ]
[ отправленный пакет без ACK            ] <--
[ пакет с ACK                           ]   |
[ отправленный пакет без ACK            ]   |- размер окна N
[ пакет с ACK                           ]   |
[ готовый, но еше не отправленный пакет ]   |
[ готовый, но еше не отправленный пакет ] <--
[ не готовый пакет                      ]
[ не готовый пакет                      ]
[ не готовый пакет                      ]
```

## <a id="UDP" href="#UDP">UDP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

UDP-сокет однозначно идентифицируется совокупностью IP-адреса хоста назначения и номера порта.

Если два UDP-сегмента имеют разные IP-адреса отправителя и/или номера портов отправителя, но одни и те же IP-адрес получателя и номер порта получателя, то оба сегмента будут направлены одному и тому же процессу получателя, использующему данный сокет.

UDP не добавляет к протоколу IP ничего, за исключением функции мультиплексирования и демультиплексирования.

Основные характеристики:
- не использует установление логического соединения;
- имеет более полный и точный контроль приложения за процессом передачи данных из-за упаковки данных и отправки их на сетевой уровень;
- содержит отсутствует установление соединения;
- не заботится о состоянии соединения;
- имеет небольшой заголовок пакета в размере 8 байт.

### <a id="Структура-UDP-сегмента" href="#Структура-UDP-сегмента">Структура UDP-сегмента</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Состоит из:
1. Номер порта отправителя - 16-бит;
2. Номер порта получателя - 16-бит;
3. Длина сообщения с заголовком в байтах - 16-бит;
4. Контрольная сумма - 16-бит;
5. Данные прикладного уровня - сообщение.

Контрольная сумма - это сумма всех 16-битных слов сегмента данных, с игнорированием всех переполнений и дополнение этой суммы до единицы, то есть инвертирование всех 0 на 1 и 1 на 0. Для проверки контрольной суммы складываются все 16-битные слова сегмента данных и контрольная сумма, если результат равен: `1111 1111 1111 1111`, то это значет что контрольная сумма совпала, иная ситуация обозначает что в пакете присутствует ошибка.
```
  0110 0110 0110 0000
+ 0101 0101 0101 0101
+ 1000 1111 0000 1100
  ------------------- - сложение всех слов пакета
  0100 1010 1100 0010
  =================== - дополнение до единицы
  1011 0101 0011 1101
```

## <a id="TCP" href="#TCP">TCP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

TCP-сокет однозначно идентифицируется совокупностью IP-адреса отправителя, номера порта отправителя, IP-адреса получателя и номера порта получателя.

Если два полученных TCP-сегмента будут иметь различные IP-адреса отправителя или номера портов отправителя, (исключая случай, когда TCP-сегмент содержит первичный запрос на установление соединения) то они будут направлены в два разных сокета.

Это соединение с установлением **логического соединения** для создания **TCP-соединение**. Обеспечивает **дуплексную** передачу файлов между процессом на одном хосте и процессом на другом хосте. Также является **двухточечным** - устанавливается между единственной парой отправитель - получатель.

**Максимальный размер сегмента** (Maximum Segment Size, MSS) - это максимальный объем данных, который может быть извлечен из буфера и помещен в сегмент. Вычисляется на основании MTU и обычно равен 1460 байт.

**Максимальный передаваемый блок** (Maximum Transmission Unit, MTU) - это длина наибольшего фрагмента канального уровня. Для протоколов канального уровня Ethernet и PPP равен 1500 байт.

TCP поддерживает **общее квитирование** - то есть квитирует принятые данные до первого отсутствующего байта.

Режим работы:
1. Клиент устанавливает TCP-соединение с сервером посредством тройного рукопожатия.
2. Передача потока данных через сокет.
3. Помещение данных в **буфер передачи**.
4. Формирование **TCP-сегменотом** и передача их на сетевой уровень.
5. При приеме происходит помещение **TCP-сегменотов** в **буфер приема** с сетевого уровня.
6. Считывание данных через сокет из буфера приема.

Квитанции о успешности приема - **вложенные** - передаются вместе с данными.

**Дублирующее подтверждение** - это копия положительной квитанции предыдущего сегмента, отправляемая в ответ на получение следующего сегмента, если порядковый номер последнего превышает ожидаемый. При приеме трух дублирующих подтверждений очуществляется **ускоренная повторная передача** пропущенного сегмента.

Является гибридом протоколов GBN и SR.

### <a id="Структура-TCP-сегмента" href="#Структура-TCP-сегмента">Структура TCP-сегмента</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Состоит из:
1. Номер порта отправителя - 16-бит;
2. Номер порта получателя - 16-бит;
3. Порядковый номер - 32-бит - это номер первого байта в сегменте в потоке байт;
4. Номер подтверждения - 32-бит - это порядковый номер следующего байта ожидаемого хостом от другого хоста;
5. Длина заголовка - 4-бит;
6. Не используется - 10-бит;
7. Флаг URG - 1-бит - обозначает, что в сегменте присутствуют срочные данные;
8. Флаг ACK - 1-бит - обозначает, что сегмент содержит подтверждение для сегмента, который был успешно получен;
9. Флаг PSH - 1-бит - обозначает, что получатель должен незамедлительно отправить данные на верхний уровень;
10. Флаг RST - 1-бит;
11. Флаг SYN - 1-бит;
12. Флаг FIN - 1-бит;
13. Окно приема - 16-бит;
14. Контрольная сумма - 16-бит;
15. Указатель срочных данных - 16-бит - местоположение последнего байта срочных данных;
16. Поле параметров;
17. Данные прикладного уровня - сообщение.

Начальные номера выбираются случайно из-за необходимости минимизировать вероятность нахождения в сети сегмента, который сформирован другим (уже закрытым) TCP-соединением между этими же двумя хостами.

### <a id="Время-оборота" href="#Время-оборота">Время оборота</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

`SampleRTT` - это выборочное время оборота (RTT) - это промежуток времени с момента отправки, т. е. передачи его протоколу IP, до прибытия подтверждения о получении сегмента. Обновляется один раз за время оборота.

`EstimatedRTT = (1 - α) × EstimatedRTT + α × SampleRTT` - это взвешенное среднее значений `SampleRTT`, где `α = 0,125`. Это величина обозначает **экспоненциальное весовое скользящее среднее**.

`DevRTT = (1 - β) × DevRTT + β × | SampleRTT - EstimatedRTT |` - это взвешенное скользящее среднее отклонений `SampleRTT` от `EstimatedRTT`, где `β = 0,25`.

`TimeoutInterval = EstimatedRTT + 4 × DevRTT` - интервал времени ожидания для повторной отправки пакета. Изначально равно 1 секунде. При превышении интервала времени ожидания удваивается. При получении сегмента расчитывается по формуле.

### <a id="Управление-потоком" href="#Управление-потоком">Управление потоком</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Управление потоком осуществляется с помощью **службы управления потоком**, которая регулирует скорость отправки данных относительно скорости считывания данных из буфера приложением. Управление происходит с помощью переменной отправителя - **окно приема**.

`RcvBuffer` - размер буфера приема.  
`LastByteRead` - номер последнего байта полученого прикладным процессом.  
`LastByteRcvd` - номер последнего байта полученого прикладным из сети и размещенном в буфере.

Для того чтобы не было переполнения буфера приема, должно соблюдаться неравенство: `LastByteRcvd - LastByteRead <= RcvBuffer`

`rwnd = RcvBuffer - [LastByteRcvd - LastByteRead]` - размер окна приема.

```
        | Размер буфера - RcvBuffer              |
        +----------------------------------------+
------> [ Свободная память | TCP данные в буфере ] --->
Данные  +------------------+
от IP   | Размер окна      |
        | приема - rwnd    |
```

`LastByteSent` - номер последнего отправленного байта.  
`LastByteAcked` - номер последнего подтвержденного байта.

`LastByteSent - LastByteAcked` - количество неподтвержденных данных.

Для того чтобы не было переполнение буфера приема, должно соблюдаться неравенство: `LastByteSent - LastByteAcked <= rwdn`.

При получении размера окна = 0, следующее сообщение должно содержать один байт данных от хоста для того чтобы получить в ответ квитанцию с новым размером окна.

### <a id="Установка-соединения" href="#Установка-соединения">Установка соединения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Основные шаги:
1. Клиент отправляет специальный TCP-сегмент протоколу TCP сервера с заголовком `SYN` установленный в 1 и случайный начальный порядковый номер (`client_isn`) с помощью IP-дейтаграммы - это **SYN-сегмент**.
2. На сервере при приеме IP-дейтаграммы с SYN-сегментом TCP выделяет буфер TCP и переменные соединения. Затем формирует сегмент с заголовком `SYN` установленный в 1, полем подтверждения `client_isn + 1` и собственным начальным номером (`server_isn`) - это **SYNACK-сегмент**.
3. На стороне клиента при получении SYNACK-сегмент выделяется буфер и переменные соединения. Затем клиент отправляет серверу сегмент подтверждающий установку соединения с заголовком `SYN` установленный в 0 и с полем подтверждения `server_isn + 1` и прикладными данными.

Если сервер не принимает соединения на указанном порту и IP-адресу, то он отправляет в ответ сегмент с заголовком `RST` установленный в 1.

После этих шагов происходит стандартный обмен данными между клиентом и сервером.

Получение клиентом:
- SYNACK-сегмента обозначает, что на порту есть слушатель;
- RST-сегмента обозначает, что на порту нет слушателя;
- ничего - обозначает, что SYN-сегмент блокирован брандмауэром.

### <a id="Закрытие-соединения" href="#Закрытие-соединения">Закрытие соединения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Основные шаги:
1. Клиент отправляет сегмент с заголовком `FIN` установленный в 1.
2. Отправка сервером подтверждающего сегмента.
3. Сервер отправляет сегмент с заголовком `FIN` установленный в 1.
4. Отправка клиентом подтверждающего сегмента.
5. Ожидание примема подтверждающего сегмента сервером в течении 30 сек, 1мин, 2мин.
6. Очистка ресурсов соединения и номеров портов.

### <a id="Управление-перегрузкой" href="#Управление-перегрузкой">Управление перегрузкой</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Основные воздействия перегрузки:
- чем ближе скорость передачи данных к пропускной способности линии связи, тем большими становятся задержки ожидания пакетов;
- отправитель должен выполнять повторную передачу отброшенных в связи с переполнением буфера пакетов;
- повторные передачи в сочетании со значительными задержками ожидания приводят к бесполезной трате значительной доли пропускной способности линий связи;
- при отбрасывании пакета на одном из маршрутизаторов работа каждого предыдущего маршрутизатора по передаче пакета получателю считается проделанной впустую.

Протокол TCP использует контроль перегрузки конечными системами.

`cwnd` - окно перегрузки, накладывает условие на скорость, с которой TCP-отправитель может отправлять трафик в сеть. Использует **подтверждения**, как триггер (или часы) для увеличения размера своего окна перегрузки и является **автосинхронизируемым**.

`LastByteSent - LastByteAcked <= min {cwnd, rwnd}` для избежания потерь пакетов.

Скорость отправки отправителя приблизительно равна `cwnd / RTT` байт/с. Регулируя значение `cwnd`, отправитель может управлять скоростью передачи данных соединения.

**Потерянная дейтаграмма** - это результат события потери у отправителя, или истечение интервала ожидания, или получение трех дублирующих ACK-пакетов, что воспринимается отправителем, как **сигнал перегрузки** на пути отправитель-получатель.

**Алгоритм управления перегрузкой протокола TCP** с аддитивным ускорением и мультипликативным замедлением (additive-increase, multiplicative-decrease, AIMD) состоит из режимов:
- **медленного старта**. В рамках него устанавливается `cwnd` равное 1 MSS и повышается на 1 MSS каждый раз, когда переданный сегмент впервые подтверждается. То есть удваивается скорость отправки каждый RTT. При наступлении события потери пакета происходит установка переменной состояния `ssthresh = cwnd / 2` и `cwnd` равное 1 MSS и повторения алгоритма медленого старта с начала до повышения `cwnd` до `ssthresh` и когда `cwnd` становится равно `ssthresh` происходит переход в режим **предотвращения перегрузки**. При получении трех дублирующих ACK-пакетов, в этом случае протокол TCP осуществляет ускоренную повторную передачу и переходит в режим **быстрого восстановления**.
- **предотвращения перегрузки**. В рамках него увеличение `cwnd` происходит на `MSS * (MSS / cwnd)` при подверждении сегмента, то есть 1 MSS каждые RTT. При наступлении события потери пакета происходит установка переменной состояния `ssthresh = cwnd / 2` и `cwnd` равное 1 MSS и переход в режим **медленного старта**. При получении трех дублирующих ACK-пакетов устанавливается `ssthresh = cwnd / 2` и `cwnd = cwnd / 2 + 3 MSS` и переходом в режим **быстрого восстановления**.
- **быстрого восстановления**. В рамках него увеличение `cwnd` происходит на 1 MSS для каждого полученного дублирующего ACK-пакета потерянного сегмента. Когда приходит ACK-пакет для пропущенного сегмента, TCP-соединение переходит в режим **предотвращения перегрузки**. При потере пакета устанавливается `ssthresh = cwnd / 2` и `cwnd` равное 1 MSS и переходит в режим **медленного старта**.

**Расслоение TCP** путем разделения TCP-соединения на внешнем сервере позволяет уменьшить задержку при расположении сервера и клиента далеко друг от друга. `4 * RTT_FE + RTT_BE + <время_обработки_сервера>` - итоговая задержка, где `RTT_FE` - время оборота между клиентом и внешним сервером `RTT_BE` - время оборота между внешним сервером и дата-центром.

`0.75 * W / RTT` - средняя скорость соединения, где `W` - размер окна передачи в момент потери пакета.

`1.22 * MSS / (RTT * L ^ 0.5)` - средняя пропускная способность соединения, где `L` - частота потерь.

Основные службы:
- служба **гарантированной доставки**;
- служба **гарантированной доставки с ограниченой задержкой**;
- служба **упорядоченной доставки пакетов**;
- служба **гарантированной максимальной пропускной способности**;
- служба **гарантированной максимального джиттера** для равных интервалов времени между последовательной отправкой пакетов и их приемов;
- служба **безопасности** для шифрования пакетов с помощью сеансовых ключей между системой отправителя и получателя.

<a id="Сетевой-уровень" href="#Сетевой-уровень">Сетевой уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
===============

Обеспечивает **логическое соединение** между хостами.

**Перенаправление** - это обработка пакета из входящего канала и передача его в соответствующий исходящий. Осуществляется с помощью **таблицы перенаправления**.

**Маршрутизация** - это маршрут перемещения пакетов от отправителя к получателю.

**Пакетный коммутатор** - это устройство, которое перенаправляет пакеты из входного интерфейса в выходной согласно значению в поле заголовка пакета и базируется на значениях в поле информационного блока канального уровня.

**Маршрутизатор** - это устройство сетевого уровня - пакетный коммутатор, работа которого зависит от заголовков сетевого уровня.

Основная и единственная служба - **служба негарантированной доставки**.

## <a id="Сети-с-виртуальными-каналами" href="#Сети-с-виртуальными-каналами">Сети с виртуальными каналами</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используют только предварительно установленные соединения.

**Виртуальный канал** состоиит из следующих элементов:
- маршрут - серия адресов и маршрутизваторов между отправителем и адресатом;
- номера виртуальных каналов для каждого соединения на всем пути следования;
- значения в таблицах маршрутизации всех тех маршрутизаторов, через которые проходит пакет.

Каждый участвующий в процессе маршрутизатор должен заменить номер следующего виртуального канала в каждом проходящем через него пакете на новый.

У каждого маршрутизатора есть таблица виртуальных каналов с полями:
- входной интерфейс;
- входящий номер виртуального канала;
- выходной интерфейс;
- выходящий номер виртуального канала.

Основные фазы функционирования:
- **фаза установления виртуального соединения** когда создается виртуальный канал с помощью добавления значений номеров виртуальных каналов в таблицы перенаправления всех маршрутизаторов в последовательности соединений.
- **фаза передачи данных** для предачи пакетов по виртуальному каналу.
- **фаза освобождения канала** когда происходит оповещение конечной системы о завершении соединения и удаляя информацию о канале со всех маршрутизаторов.

Все общение происходит с помощью **сигнального протокола** через **сигнальные сообщения**.

## <a id="Дейтаграммные-сети" href="#Дейтаграммные-сети">Дейтаграммные сети</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Работают без установления соединения и каждый раз, когда возникает необходимость отправить пакет, конечная система оставляет на пакете пометку с целевым адресом и просто выпускает его в сеть.

Для перенаправления в нужный канал используется сравнение префикса адреса получателя пакета с записями в таблице и при наличии многократных соответствий маршрутизатор использует **правило наибольшего совпадения** префикса с записями и отправляет пакет по наиболее совпавшей записи.

## <a id="Маршрутизатор" href="#Маршрутизатор">Маршрутизатор</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Состоит из:
- **уровня перенаправления данных маршрутизатора**:
    - **входных портов** - функционирующие на физическом уровне и выполняют функции поиска и выбора выходного порта и передачи пакета в коммутирующую матрицу. Работают на аппаратной реализации.
    - **коммутирующей матрицы** - которая соединяет входные порты маршрутизатора с выходными портами, создавая при этом условную сеть внутри маршрутизатора. Используется для копирования пакетов из входных портов в выходные. Работают на аппаратной реализации. Осуществляется с помощью:
        - **коммутации через память** с использованием процессора маршрутизации в память которого копировался пакет, который перенаправляет пакет в нужный порт.
        - **коммутация через шину** когда к каждому пакету в входном порте присоединяется внутренняя метка выходного порта и перенаправлением пакета в шину, для получения этого пакета всеми выходными портами, но сохраняет пакет только тот порт, который указанный в метке.
        - **коммутация через соединительную сеть** с использованием шин, где каждая вертикальная шина пересекает каждую горизонтальную шину. Любая точка пересечения может быть открыта или закрыта в любой момент контроллером коммутирующей матрицы для перенаправления пакета.
    - **выходных портов** - которые хранят пакеты для передачи в исходящий канал. Работают на аппаратной реализации.
- **уровня управления маршрутизатором**:
    - **процессора маршрутизации** - который выполняет протоколы маршрутизации, обрабатывает таблицы маршрутизации и прилагаемую информацию о состоянии соединения, а также составляет таблицу перенаправления для маршрутизатора. Кроме того, он выполняет функции управления сетью. Работают на программной реализации.

## <a id="Протокол-IP-Internet-protocol" href="#Протокол-IP-Internet-protocol">Протокол IP (Internet protocol)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

### <a id="Дейтаграмма" href="#Дейтаграмма">Дейтаграмма</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

**Дейтаграмма** - это пакет сетевого уровня.

Структура IPv4 дейтаграммы:
1. Номер версии - 4 бита - цифра 4;
2. Длина заголовка - 4 бита, многие не имеют дополнительных опций и поэтому типичный размер 20 байт;
3. Тип обслуживания - 8 бит;
4. Длина дейтаграммы - 16 бит - общая длина - заголовок и данные;
5. Идентификатор - 16 бит - идентификатор фрагмента;
6. Флаги - 3 бита - 0 - последний (нет более фрагментов), 1 - остальные (есть еще фрагменты);
7. Смещение фрагмента - 13 бит - смещение в байтах от начала;
8. Время жизни (time-to-live (TTL)) - 8 бит, при каждом прохождении дейтаграммы через маршрутизатор значение постепенно уменьшается и при достижении 0, дейтаграмма перестает передаваться;
9. Протокол - 8 бит - определяет протокол траспортного уровня, 6 - TCP, 17 - UDP, и используется для связи сетевого уровня и траспортного.
10. Контрольная сумма заголовка - 16 бит - вычисляется путем интерпретации каждых двух байтов заголовка как числа и суммирования получившихся чисел с использованием арифметики дополнения до единицы; дейтаграммы с невалидными контрольными суммами отбрасываются; при каждом прохождении дейтаграммы вычисляется повторно;
11. IP-адрес источника - 32 бита;
12. IP-адрес места назначения - 32 бита;
13. Опции - динамическая длина;
14. Данные - динамическая длина, содержит сегмент транспортного уровня.

**Фрагмент** - это часть дейтаграммы для передачи в канальный уровень, в котором MTU меньше текущего. Фрагменты могут создаваться маршрутизаторами, но собираются воедино только при передачи на транспортный уровень, когда полностью востановится.

Процесс фрагментирования дейтаграммы размером 4000 байт при отправке в канал со значением MTU = 1500 байт.

Из 4000 байт полезной нагрузки 4000 байт - 20 байт заголовков = 3980 байт.

Фрагмент | Байты данных | Идентификатор | Смещение | Флаг
-------- | ------------ | ------------- | -------- | ----
1        | 1480         | 777           | 0        | 1
2        | 1480         | 777           | 185      | 1
3        | 1020         | 777           | 370      | 0

Точка сопряжения между хостом и физическим каналом и точка сопряжения маршрутизатора с любым из его каналов называются **интерфейсом**. Каждый интерфейс каждого хоста и маршрутизатора имеет свой IP-адрес. Адрес не может быть выбран произвольно. Часть IP-адреса будет определяться той подсетью, к которой подключен интерфейс.

`<32_бита>` - IP-адрес.  
`<8_бит>.<8_бит>.<8_бит>.<8_бит>` - IP-адрес.

**Подсеть** (IP-сеть) - это множество интерфейсов хостов машин и один интерфейс маршрутизатора.

**Маска подсети** - указывает, что указанное количество крайних левых бит адреса определяют адрес подсети (**префикс**) - `<8_бит>.<8_бит>.<8_бит>.<8_бит> / <маска_подсети>`.
> `200.23.16.0/20`

**Бесклассовая междоменная маршрутизация** - это стратегия присваивания адресов в Интернете, когда IP-адреса устройств во всей организации совместно используют общий префикс.

Адрес `255.255.255.255` - это **широковещательный адрес**, когда при отправлении на него дейтаграммы, то сообщесние приходит на все хосты, расположенные в данной подсети.

Адреса хостов конфигурируются вручную, либо с использованием **протокола динамического конфигурирования хостов** (Dynamic Host Configuration Protocol, DHCP), который может выдавать постоянный или временный адрес хосту. Этапы работы DHCP:
1. **Обнаружение DHCP-сервера** - происходит с помощью сообщения обнаружения DHCP, который представляет собой UDP-пакет с портом 67 на IP-адресом получателя `255.255.255.255` (широковещательный адрес) и IP-адресом отправителя `0.0.0.0`.
2. **Предложение(я) DHCP-сервера** - каждый DHCP-сервер отправляет в ответ широковещательное сообщение на порт 68 с предложением, которое содержит:
    - транзакционный идентификатор полученного сообщения обнаружения;
    - предлагаемый клиенту IP-адрес;
    - маску подсети;
    - время аренды адреса.
3. **DHCP-запрос** - после выбора DHCP-сервера, клиент отправляет сообщение запроса DHCP на порт 67, передавая вместе с ним параметры конфигурации, которые ранее были получены от сервера.
4. **DHCP-подтверждение (ACK)** - подтверждение сервером запроса с ответом на порт 68 конфигурацией.

### <a id="Трансляция-сетевых-адресов-network-address-translation-NAT" href="#Трансляция-сетевых-адресов-network-address-translation-NAT">Трансляция сетевых адресов (network address translation, NAT)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

**Область частных адресов** - это сеть, чьи адреса являются значимыми лишь для устройств, расположенных в ее пределах. Содержатся в адресном пространстве `10.0.0.0/8`.

Маршрутизатор с поддержкой NAT для внешнего мира выглядит как единое устройство с всего одним IP-адресом и скрывает детали домашней сети. Все дейтаграммы, прибывающие на NAT-маршрутизатор из глобальной сети, имеют один и тот же IP-адрес получателя - адрес маршрутизатора. Маршрутизатор сам получает IP-адрес и раздает адреса внутри своей сети (с помощью DHCP).

**Трансляция сетевых адресов** сопоставляет внутреннюю и внешнию сеть с помощью таблицы в которой имеются такие поля:
1. Внутренний адрес отправителя;
2. Внутренний порт отправителя;
3. Внешний адрес отправителя;
4. Внешний порт отправителя.

Основной алгоритм работы:
1. Хост отправляет дейтаграмму в локальную сеть со своим адресом и исходящим портом.
2. NAT-маршрутизатор получает дейтаграмму, генерирует для нее новый номер исходного порта из пула свободных, заменяет исходный IP-адрес соответствующим внешним IP-адресом и заменяет старый номер исходного порта новым. И добавляет эту связку в таблицу трансляция сетевых адресов. А затем отправляет ее в сеть.
3. При получении дейтаграммы от сервера NAT-маршрутизатор на основании таблицы трансляция сетевых адресов переписывает адрес назначения дейтаграммы и номер порта назначения и пересылает ее в домашнюю сеть.

Для обхода NAT используется **реверс соединения**, когда с помощью посредника, который не скрыт за NAT для того чтобы установить прямое одноранговое TCP-соединение.

**Протокол UPnP** позволяет хосту обнаружить и сконфигурировать близлежащий NAT-маршрутизатор и получить у NAT-маршрутизатора (частный IP-адрес, частный номер порта) и (общедоступный IP-адрес, общедоступный номер порта) для того порта, номер которого был запрошен - **создать окно** отображения адреса.

### <a id="Протокол-управляющих-сообщений-Интернета-ICMP" href="#Протокол-управляющих-сообщений-Интернета-ICMP">Протокол управляющих сообщений Интернета (ICMP)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используется хостами и маршрутизаторами для обмена информацией сетевого уровня друг с другом. Чаще всего этот протокол применяется для передачи сообщений об ошибках.

С архитектурной точки зрения он располагается прямо над IP, поскольку сообщения ICMP передаются внутри IP-дейтаграмм.

Сообщения ICMP содержат:
1. Тип.
2. Поле с кодом.
3. Заголовок.
4. 8 байт IP-дейтаграммы из-за которой произошла ошибка.

Тип ICMP | Код | Описание
-------- | --- | --------
`0`      | `0` | Эхо-отклик (на команду ping)
`3`      | `0` | Сеть назначения недостижима
`3`      | `1` | Хост назначения недостижим
`3`      | `2` | Протокол назначения недостижим
`3`      | `3` | Порт назначения недостижим
`3`      | `6` | Сеть назначения неизвестна
`3`      | `7` | Хост назначения неизвестен
`4`      | `0` | Подавление источника (борьба с перегрузками)
`8`      | `0` | Эхо-запрос
`9`      | `0` | Объявление маршрутизатора
`10`     | `0` | Обнаружение маршрутизатора
`11`     | `0` | Предписанное время жизни истекло
`12`     | `0` | Недопустимый IP-заголовок

### <a id="IPv6" href="#IPv6">IPv6</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Структура IPv6 дейтаграммы:
1. Номер версии - 4 бита - цифра 6;
2. Класс трафика - 8 бит - аналогично полю TOS (тип обслуживания) в IPv4;
3. Метка потока - 20 бит - для идентификации потока дейтаграмм;
4. Размер полезных данных - 16 бит - количество байт в дейтаграмме, следующих за заголовком (так как заголовок имеет фиксированный размер 40 байт);
5. Следующий заголовок - 8 бит - указывается тип протокола (6 - TCP, 17 - UDP);
6. Лимит переходов - 8 бит - аналогично времени жизни (time-to-live (TTL));
7. Адрес отправителя - 128 бит;
8. Адрес получателя - 128 бит;
9. Данные - динамическая длина.

В рамках IPv6 появился ICMPv6 с измененными кодами и новыми типами и кодами.

## <a id="Алгоритмы-маршрутизации" href="#Алгоритмы-маршрутизации">Алгоритмы маршрутизации</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Цель алгоритма маршрутизации: имея набор маршрутизаторов, которые соединены каналами, найти оптимальный путь (**тракт**) от начального маршрутизатора (по умолчанию) к конечному. Бывают:
- **глобальный алгоритм маршрутизации** (алгоритм, учитывающий состояние каналов (link-state algorithm, LS)) - вычисляет наименее затратный путь между исходной и конечной точкой, опираясь на исчерпывающие сведения обо всей структуре сети (топологию сети и стоимость каналов) с помощью алгоритма Дейкстры.
- **децентрализованный алгоритм маршрутизации** (дистанционно-векторный алгоритм (distance-vector algorithm, DV)) - где расчет пути с наименьшей стоимостью выполняется итерационным распределенным образом. Расчеты производятся итеративно и распределенно на каждом узле с помощью уравнения Беллмана - Форда: $D_x(y) = \min \{c(x, v) + D_v(y)\}$ для каждого узла во множестве N.

Маршрутизаторы объединяются в отдельные области - **автономные системамы** (Autonomous System, АС), которые используют внутри себя один и тот же алгоритм маршрутизации - **протокол внутренней маршрутизации**. Внутри автономной сети имеются ****шлюзовые (граничными) маршрутизаторы** (шлюзы) для пересылки пакетов за пределы автономной системы. Внутри каждого внутреннего маршрутизатора есть **протокол внешней маршрутизации автономной системы** - BGP4.

## <a id="Протоколы-внутренней-маршрутизации-в-Интернете" href="#Протоколы-внутренней-маршрутизации-в-Интернете">Протоколы внутренней маршрутизации в Интернете</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

### <a id="Протокол-маршрутной-информации-Routing-Information-Protocol-RIP" href="#Протокол-маршрутной-информации-Routing-Information-Protocol-RIP">Протокол маршрутной информации (Routing Information Protocol, RIP)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Использует дистанционно-векторный алгоритм со стоимостью весов равным 1 с максимальной стоимостью пути равной 15. Каждые 30 секунд происходит обмен свединиями с соседними маршрутизаторами списком с максимальным количеством сетей адресатов равным 25 через RIP-объявления с использованием протокола UDP и 520 порта.

У каждого маршрутизатора есть таблица с полями:
- подсеть назначения;
- следующий маршрутизатор, с помощью которого можно попасть в указанную подсеть;
- количество переходов до места назначения.

RIP-объявления содержат таблицу маршрутизатора, на основании которой изменяется внутрення таблица. Если от соседнего маршрутизатора не поступают пакеты в течение 180 секунд, то данный маршрутизатор считается недоступным и производится обновление внутренней таблицы и рассылка RIP-объявлений.

### <a id="Открытый-протокол-выбора-кратчайшего-маршрута-Open-Shortest-Path-First-OSPF" href="#Открытый-протокол-выбора-кратчайшего-маршрута-Open-Shortest-Path-First-OSPF">Открытый протокол выбора кратчайшего маршрута (Open Shortest Path First, OSPF)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Использует глобальный алгоритм маршрутизации со стоимостью весов, которые передаются из вне. С помощью широковещательной рассылки переправляет информацию о маршрутах всем маршрутизаторам автономной системы, а не только соседним при каждом изменении состояния каналов, а также раз в 30 мин рассылает информацию о состоянии линий через OSPF-сообщения на основе IP-дейтаграмм по протоколу OSPF = 89.

## <a id="Протокол-граничных-маршрутизаторов-BGP" href="#Протокол-граничных-маршрутизаторов-BGP">Протокол граничных маршрутизаторов (BGP)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используется для маршрутизации между автономными системами и обеспечивает:
1. Получения информации о достижимости подсетей от смежных автономных систем;
2. Распространения информации о достижимости между всеми внутренними маршрутизаторами конкретной автономной системы;
3. Определения "хороших" маршрутизаторов для попадания в подсети, на основе информации о достижимости и политики, применяемой в автономной системе.

Основное назначение пртокола - это уведомить Интернет о существовании подсети. Протокол BGP позволяет каждой автономной системе узнать, какие места достижимы через ее соседние автономные системы.

Для обмена информацией используется полупостоянные TCP-соединения по порту 179 - **BGP-сеанс**, которые существуют для каждого канала, который связывает два маршрутизатора - **BGP-партнера** (BGP-пира) из разных автономных систем - **внешний BGP-сеанс (eBGP)**. Также существуют внутренние соединения между маршрутизаторами - **внутреннй BGP-сеанс (iBGP)**.

Каждый узел имеет **CIDR-префикс**, который представляет собой подсеть или коллекцию подсетей.
> `138.16.64/24, 138.16.65/24, 138.16.66/24, 138.16.67/24`

При установке сеанс eBGP корневой маршрутизатор распространяет список тех префиксов, которые достижимы из автономной системы, а затем полученные префиксы распространяет внутри через сеанс iBGP.

Каждая автономная система имеет свой номер (Autonomous System Number, ASN), который ей выдается ICANN. Для объявления префикса используются **BGP-атрибуты**, и в сочетании с ними образутся **маршрут**. Основные атрибуты:
- **AS-PATH** - в котором указываются автономные системы, через которые прошло объявление префикса. Если маршрутизатор обнаружит, что его автономная система уже упомянута в атрибуте AS-PATH, он отклонит такое объявление.
- **NEXT-HOP** - соответствует маршрутизатору-интерфейсу, с которого начинается путь AS-PATH.

Когда шлюзовой маршрутизатор получает объявление о маршруте, он задействует свою **политику импорта** (import policy), чтобы решить, принять или пропустить этот маршрут, а также следует ли снабдить его теми или иными атрибутами, например, параметрами приоритета.

Для определения маршрута используются такие правила:
- маршруты выбираются на основании локального предпочтения;
- оставшие маршруты выбираются по кратчайшим AS-PATH;
- оставшие маршруты выбираются по ближайшим NEXT-HOP;
- оставшие маршруты выбираются по BGP-идентификаторам.

## <a id="Широковещательная-и-групповая-маршрутизация" href="#Широковещательная-и-групповая-маршрутизация">Широковещательная и групповая маршрутизация</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

При **широковещательной маршрутизации** (broadcast routing) сетевой уровень обеспечивает доставку пакета от отправителя всем остальным хостам в сети.

Основные алгоритмы:
- **N-адресной метод** - когда исходный узел просто создает N копий пакета, посылает каждую копию на конкретный адрес при помощи одноадресной маршрутизации. Плюсы:
    - работает на существующей инфраструктуре.

    Минусы:
    - копирование пакетов происходит на отправителе, что перегружает канал;
    - необходимо знать о всех адресах назначений пакетов.

- **Неуправляемая лавинообразная маршрутизация** (флудинг) - в этом случае исходный узел посылает копию пакета всем своим соседним узлам, а те своим соседним и т.д. Плюсы:
    - простота.

    Минусы:
    - при наличие циклов в графе образуется **широковещательный шторм** по причине бесконечного размножения пакетов.

- **Управляемая лавинообразная маршрутизация** - подобно неуправляемой, только в каждый пакет исходный узел записывает в широковещательный пакет свой адрес (какой либо уникальный идентификатор) и **порядковый широковещательный номер**, а каждый принимающий узел ведет список исходных адресов и порядковых номеров всех пакетов, которые он уже получил и не пересылает те, которые были приняты и пересланы ранее.

- **переадресация в обратном направлении** (reverse path forwarding, RPF) - подобно неуправляемой лавинообразной маршрутизации, только пересылка осуществляется только тех пакетов, которые прибыли по тому каналу, который находится на кратчайшем одноадресном пути к источнику пакета.

- **метод связующего дерева** - когда для пересылке пакетов используется минимально связующее дерево графа, тогда узлы пересылают пакеты дальше только по всем своим соседним узлам в связующем дереве. Дерево строится с помощью **центрированного подхода**, при котором в дереве определяется центральный узел (точка рандеву / ядро) и далее все узлы одноадресно передают центральному узлу сообщения для объединения дерева методом одноадресной маршрутизации к центру, пока не достигнет либо одного из узлов, уже относящихся к связующему дереву, либо, центра и таким образом путь "прививается" к дереву.

При **групповой маршрутизации** (многоадресная) (multicast routing) один отправитель отсылает копии пакета подмножеству других хостов сети. Для этого используется групповая дейтаграмма, которая **адресуется косвенно**, т. е. для группы получателей - **группы рассылки** используется один идентификатор.

Для создания групп рассылок используется **протокол IGMP** (Internet Group Management Protocol) - протокол управления группами Интернета, который работает между хостом и соединенным с ним напрямую маршрутизатором. С помощью этого протокола информируется маршрутизатор о том, что хост хочет присоединится к группе рассылки. Используются сообщения по номеру протокола 2 в IP-дейтаграмме:
- **membership_query** - отправляет маршрутизатор всем хостам в локальной сети для того, чтобы узнать обо всех группах рассылки, членами которых стали хосты данного интерфейса;
- **membership_report** - отправка хостом информации о своих группах оасслки при получении сообщения **membership_query** или при первом присоединении к сети;
- **leave_group** - отправка хостом информации о покидании группы.

Цель **групповой маршрутизации** заключается в том, чтобы построить дерево, связывающее все маршрутизаторы, присоединенные хосты которых относятся к данной группе рассылки. При этом групповые пакеты будут направляться по этому дереву от отправителя ко всем хостам, входящим в дерево группы рассылки. Основные подходы:
- **групповая маршрутизация с общим деревом** - когда дерево строится с помощью метода связующего дерева;
- **групповая маршрутизация с использованием дерева для каждого источника** - когда дерево строится для каждого источника с использованием переадресации в обратном направлении и отсечением не нужных узлов, когда маршрутизатор, получающий групповые пакеты, у которого нет соединенных с ним напрямую хостов, принадлежащих этой группе, посылает отсекающее сообщение маршрутизатору "выше по течению".

<a id="Канальный-уровень" href="#Канальный-уровень">Канальный уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
=================

**Узел** - это любое устройство, использующее протокол канального уровня - это хосты, маршрутизаторы, коммутаторы и точки доступа Wi-Fi.

**Канал линии связи** - это связи смежных узлов вдоль линии передачи данных. Для передачи дейтаграммы с исходного на конечный хост, ее нужно переслать по всем отдельным каналам полного пути от хоста к хосту.

Основные службы:
- **формирование кадра** - помещение дейтаграммы в кадр канального уровня;
- **доступ к каналу связи** - с помощью протокола управления доступом к среде пе редачи (MAC, Media Access Control) определяются правила передачи кадра в канал;
- **надежная доставка** - которая исправляет ошибки в канале, в котором они возникли (локально);
- **обнаружение и исправление ошибок** - для проверки и исправления ошибок дейтаграмм с помощью контрольных сумм.

Канальный уровень в основном реализован в **сетевом адаптере** - **сетевой интерфейсной платой** (network interface card, NIC), который реализован аппаратно, в котором есть конроллер, который отвечает за основные службы, а также имеется программная часть.