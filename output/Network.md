[Содержание](#Содержание)
==========

- [Компьютерные сети и интернет](#Компьютерные-сети-и-интернет)
    - [Основные понятия](#Основные-понятия)
    - [Сети доступа](#Сети-доступа)
        - [Физическая среда](#Физическая-среда)
    - [Ядро сети](#Ядро-сети)
    - [Задержки в сетях с коммутацией пакетов](#Задержки-в-сетях-с-коммутацией-пакетов)
    - [Уровни протоколов](#Уровни-протоколов)
- [Прикладной уровень](#Прикладной-уровень)
    - [HTTP](#HTTP)
        - [Формат сообщения](#Формат-сообщения)
            - [Формат запроса](#Формат-запроса)
            - [Формат ответа](#Формат-ответа)
    - [FTP](#FTP)
        - [Команды](#Команды)
    - [Электронная почта](#Электронная-почта)
        - [POP3](#POP3)
        - [IMAP](#IMAP)
    - [DNS](#DNS)
        - [DNS сообщения](#DNS-сообщения)
    - [Одноранговые приложения](#Одноранговые-приложения)
        - [Протокол для передачи файлов BitTorrent](#Протокол-для-передачи-файлов-BitTorrent)
        - [Распределенные хеш-таблицы (distributed hash table, DHT)](#Распределенные-хеш-таблицы-distributed-hash-table-DHT)
- [Транспортный уровень](#Транспортный-уровень)
    - [UDP](#UDP)
    - [TCP](#TCP)
- [Сетевой уровень](#Сетевой-уровень)

<a id="Компьютерные-сети-и-интернет" href="#Компьютерные-сети-и-интернет">Компьютерные сети и интернет</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
============================

## <a id="Основные-понятия" href="#Основные-понятия">Основные понятия</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

**Интернет** - это компьютерная сеть, которая связывает **хосты**, **конечные системы** между собой.

**Конечные системы** соединяются вместе с помощью сети **линий связи** и **коммутаторов пакетов**.

**Скорость передачи линии** измеряется в битах в секунду (бит/c).

Коммутатор пакетов получает пакет по одной из своих входных линий связи и направляет его по одной из своих исходящих линий связи. Подразделяются на:
- **маршрктизаторы**;
- **коммутаторы канального уровня**.

Последовательность линий связи и коммутаторов пакетов, через которые проходит пакет из отправляющей конечной системы в принимающую, называется **маршрутом** или **путем** в сети.

**Интернет-провайдеры** (Internet Service Providers, ISP) - дают конечным системам доступ в Интренет.

Конечные системы, коммутаторы пакетов и другие части Интернета выполняют **протоколы**, которые управляют передачей и получением информации в Интернете. Основные протоколы в Интернете:
- **протокол управления передачей** (Transmission Control Protocol, TCP);
- **протокол Интернета** (Internet Protocol, IP).

**Протокол** определяет формат и порядок сообщений, которыми обмениваются два или более взаимодействующих объектов, а также действия, предпринимаемые при передаче и/или приеме сообщения либо при возникновении другого события.

## <a id="Сети-доступа" href="#Сети-доступа">Сети доступа</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

**Абонентская цифровая линия** (digital subscriber line, DSL) - сигнал передается с помощью кабельной телефонной инфраструктуры. Скорости передачи данных:
- 12 Мбит/с на входе и 1,8 Мбит/с на выходе;
- 24 Мбит/с на входе и 2,5 Мбит/с на выходе.

**Кабельный доступ** - сигнал передается с помощью кабельной телевизионной инфраструктуры. Является совместным средсвом вещания. Скорости передачи данных:
- 42,8 Мбит/с на входе и 30,7 Мбит/с на выходе.

**Оптоволоконная линия** - сигнал передается с помощью волоконно-оптического соединения от центрального офиса напрямую в дом. Скорости передачи данных:
- от 51,8 Мбит/с до 39,8 Гбит/с.

**Спутниковый канал** - сигнал передается с помощью радио.

### <a id="Физическая-среда" href="#Физическая-среда">Физическая среда</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Подразделяется на:
- **проводную**:
    - **медная витая пара** - состоит из двух изолированных медных проводов, каждый из которых имеет толщину около 1 мм, заключенных в обычную спиральную оболочку. Провода переплетены друг с другом для уменьшения электрических помех, идущих от находящихся рядом проводов. Обычно несколько пар проводов объединяют вместе в один кабель и помещают их в защитный экран.
    - **коаксиальный кабель** - состоит из двух медных проводников, только эти проводники расположены не параллельно, а концентрически (или коаксиально).
    - **оптоволоконный кабель** - это тонкий, гибкий кабель, по которому распространяются световые импульсы, представляющие собой биты информации.
- **беспроводную**:
    - **наземные радиоканалы** - сигналы передаются посредством электромагнитных волн радиодиапазона.
    - **спутниковые радиоканалы** - соединяет два или более наземных приемопередатчика сверхвысокочастотного (СВЧ) диапазона (наземные станции). Спутник принимает сигнал на одной полосе частот, восстанавливает его с использованием ретранслятора и передает на другой частоте.

## <a id="Ядро-сети" href="#Ядро-сети">Ядро сети</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Конечные системы обмениваются друг с другом **сообщениями**, используя сетевые приложения. Сообщения разбиваются на более мелкие порции данных - **пакеты**.

Пакеты передаются по каждой линии связи с максимальной скоростью, которую может обеспечить данная линия. Поэтому, если исходная конечная система либо коммутатор отсылает пакет длиной `L` бит через соединение со скоростью `R` бит/с, то время передачи пакета равно `L/R` секунд.

**Передача с промежуточным накоплением** - означает, что коммутатор пакетов должен сначала принять пакет целиком перед тем, как он начнет передавать в выходную линию связи его первый бит. Чем больше комутаторов с промежуточным накоплением, тем вышезадержка: `d = N * L/R`, где `N` - количество соединений.

У каждого комутатора есть **выходной буфер** (выходая очередь) в котором хранятся пакеты для отправки в данную линию связи. Если, например, прибывающий пакет нужно отправить в линию связи, но она занята передачей другого пакета, то прибывающий пакет должен встать в очередь в выходном буфере.

Пакеты, вставая в очередь, испытывают задержки ожидания - **задержку накопления**. Когда выходной буфер полностью заполнен прибывшими пакетами, а пакеты все поступают и поступают, то происходит **потеря пакетов**. Отбрасывается либо один из прибывающих пакетов, либо один из тех, которые уже находятся в очереди.

Каждая конечная система в Интернете имеет свой адрес - **IP-адрес**. При передачи пакета в заголовок пакета включается IP-адрес места назначения.

У маршрутизаторов есть **таблица маршрутизации**, которая ставит в соответствие адреса места назначения (либо часть адресов места назначения) с исходящими соединениями маршрутизатора.

Подходы к методам передачи данных по сетям:
- **коммутация каналов** - ресурсы, необходимые для обеспечения взаимодействия между конечными системами (буфер, скорость передачи), резервируются на время соединения между системами. Организуется с помощью:
    - **мультиплексирования с частотным разделением** (frequency-division multiplexing, FDM) - спектр частот всей линии делится между установленными каналами, то есть каждому каналу на все время соединения отводится определенная полоса частот - ширина - **полоса пропускания**;
    - **мультиплексирования с временным разделением** (time-division multiplexing, TDM) - время разбивается на фиксированные промежутки - **кадры**, а кадры делятся на фиксированное число **слотов**, которые используются для передачи данных только для одного соединения.
- **коммутация пакетов** - ресурсы, необходимые для обеспечения взаимодействия между конечными системами (буфер, скорость передачи), не резервируются; сеанс взаимодействия использует ресурсы по запросу и как следствие может ожидать (то есть вставать в очередь) доступа к освободившемуся соединению.

**Точка присутствия** (Points of Presents или PoP) - это группа из одного или нескольких маршрутизаторов (расположенных в одном и том же месте) сети провайдера, к которым могут подключаться маршрутизаторы сети заказчика.

**Многоинтерфейсное подключение** - соединение с двумя или более провайдерами верхнего уровня.

**Пиринговое соединение** - это соединение сетей напрямую таким образом, чтобы трафик между ними не шел через промежуточные каналы связи.

**Точки обмена Интернет-трафиком** (Internet Exchange Point, IXP) - это коммутаторы, через которые провайдеры могут устанавливать пиринговое взаимодействие между собой.

**Сеть провайдеров контента** - взаимосвязаны частной сетью (TCP/IP сетью), но, которая отделена от публичного Интернета.

```
    [Провайдер 1-го уровня]----[Провайдер 1-го уровня]----[Провайдер контента]
        |      |    |               |     |                 |       |       |
        |      |    |               |     |                 |       |       |
        |      |    |               |     |                 |       |       |
        |    [IXP]  |               |     |----------------[IXP]    |       |
        |      |    |               |                       |       |       |
        |      |    |               |                       |       |       |
        |      |    |               |                       |       |       |
        |      | [Региональный провайдер]--------[Региональный провайдер]   |
        |      |        |             |                 |                   |
        |      |        |             |                 |                   |
        |      |        |             |                 |                   |
    [Сеть доступа]  [Сеть доступа]  [Сеть доступа]  [Сеть доступа]  [Сеть доступа]
```

## <a id="Задержки-в-сетях-с-коммутацией-пакетов" href="#Задержки-в-сетях-с-коммутацией-пакетов">Задержки в сетях с коммутацией пакетов</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Виды задержек на узлах:
- **задержка обработки** - это время, необходимое на проверку заголовка пакета и определение дальнейшего его маршрута - менее микросекунд;
- **задержка ожидания** - это время нахождения в очереди на передачу линии связи - от нескольких микросекунд до нескольких миллисекунд;
- **задержка передачи** - это время передачи всех битов пакета на линию связи, равна длине пакета деленная на пропускную способность сети - от нескольких микросекунд до нескольких миллисекунд;
- **задержка распространения** - это время затраченое на прохождение пути между маршрутизаторами, равна растоянию деленному на скорость распространения по линии связи - несколько миллисекунд.

В сумме дают задержку узла.

**Интенсивность трафика** - это количество пакетов умноженое на их длину и поделенное на скорость передачи по линии связи. Если эта величина больше 1, то возникает задержка, которая будет бесконечно увеличиваться. В случае приближения к 1 будет формироваться очередь.

Общая задержка будет равна сумме задержек на узлах по маршруту.

## <a id="Уровни-протоколов" href="#Уровни-протоколов">Уровни протоколов</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Каждый протокол принадлежит определнному уровню и каждый уровень предоставляет **услуги** уровню выше - это **модель обслуживания** уровня.

Уровни по стекам протоколов:
1. **Прикладной** - поддерживает сетевые приложения и их протоколы. Обслуживает множество конечных систем, которые обмениваются **сообщениями** - порциями данных.
2. **Транспортный** - осуществляет передачу сообщений прикладного уровня между конечными приложениями, с помощью протоколов **TCP** и **UDP**, которые разбавают сообщения на более короткие **сегменты** - порции данных для передачи друг другу.
3. **Сетевой** - отвечает за передачу порций данных - **дейтаграммы**, от одного хоста сети к другому по цепочке маршрутизаторов от источника к приемнику в Интернете. Обеспечивает службу для доставки сегмента транспортного уровня по адресу назначения на транспортный уровень получателя. Включает:
    - протокол **IP**, который определяет поля дейтаграмм, а также действия, которые должны производить конечные системы и маршрутизаторы с этими полями;
    - протоколы маршрутизации, которые определяют маршруты прохождения дейтаграмм между хостами-источниками и хостами-приемниками.
4. **Канальный** - обеспечивает передачу **кадров** - порции данных. Имеет множество протоколов: Ethernet, Wi-Fi и д.р.
5. **Физический** - обеспечивает передачу битов кадров. Имеет множество протоколов.

Каждый уровень добавляет **поле заголовока** к **полю данных**, которые он получил из уровня выше.

**Коммутаторы** работают с канальными и физическими уровнями, а **маршрутизаторы** еще с сетевым.

<a id="Прикладной-уровень" href="#Прикладной-уровень">Прикладной уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
==================

**Клиент-серверная архитектура** - это такая архитектура, в которой существует один **хост** - **сервер**, который постоянно находится в режиме онлайн и обслуживает запросы от других многочисленных хостов - **клиентов**. Сервер имеет фиксированный IP-адрес.

**Одноранговая (P2P) архитектура** - это такая архитектура, в которой применение серверов сведено до минимума или вообще до нуля и приложения используют непосредственное взаимодействие между парой соединенных хостов - **пирами** (**партнерами** или **узлами**).

Существуют также гибриды архитектур.

В контексте сеанса взаимодействия между парой процессов тот, который инициирует это взаимодействие (то есть первоначально контактирует с другим процессом в начале сеанса), обозначается как **клиентский**. Процесс, который ожидает контакта для начала сеанса, обозначается как **серверный**.

Процессы отправляют и принимают сообщения через программный интерфейс - **сокет**, который является интерфейсом между процессом приложения и протоколом транспортного уровня.

Для протокола TCP существуют два сокета:
- **входной сокет** - является начальной точкой контакта для всех клиентов, ожидающих соелинения с сервером и используется для тройного рукопожатия;
- **сокет соединения** - создается для каждого клиента и используется для связи.

Для идентификации процесса-получателя необходим его **IP-адрес** и **номер порта**.

Протокол прикладного уровня определяет:
- Типы сообщений, которыми обмениваются процессы, например сообщения запроса или сообщения ответа;
- Синтаксис различных типов сообщений, то есть состав полей сообщения и их порядок;
- Семантика полей, то есть значение информации, содержащейся в каждом из них;
- Набор правил для определения времени и порядка передачи сообщений и получения ответов.

Виды протоколов:
- **push** - протокол отправки;
- **pull** - протокол получения.

## <a id="HTTP" href="#HTTP">HTTP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

HTTP (протокол передачи гипертекста) - это протокол прикладного уровня для Всемирной паутины.

HTTP использует TCP в качестве базового транспортного протокола.

HTTP - это протокол без сохранения состояния.

**Веб-страница** (**документ**) состоит из объектов. **Объект** - это простой файл, имеющий уникальный URL-адрес, например файл формата HTML, изображение в формате JPEG, Java-апплет или видеоклип. Большинство веб-страниц состоит из базового HTML файла, который содержит ссылки на несколько объектов.

**Время оборота** (**round-trip time**, **RTT**) - это время, требуемое пакету малого размера для передачи от клиента к серверу и обратно (**время двусторонней задержки**). Из-за тройного рукопожатия TCP общее время ответа приблизительно равно удвоенному времени оборота плюс время на передачу данных.

Виды HTTP-соединений:
- **непостоянное** - когда на каждый запрос к одному серверу происходит открытие и закрытие TCP соединений;
- **постоянное** - когда все запросы к одному серверу идут последовательно через одно TCP соединение.

### <a id="Формат-сообщения" href="#Формат-сообщения">Формат сообщения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

#### <a id="Формат-запроса" href="#Формат-запроса">Формат запроса</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

```
| метод | sp | URL | sp | версия | cr | lf |          <- строка запроса
| имя поля заголовка | sp | значение | cr | lf | < -\
|                                              | < - | - строки заголовка
| имя поля заголовка | sp | значение | cr | lf | < -/
| cr | lf |                                      <- пустая строка
|                                              | < -\
|                                              | < - | - тело сообщения
|                                              | < -/
```

#### <a id="Формат-ответа" href="#Формат-ответа">Формат ответа</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

```
| версия | sp | код | sp | фраза | cr | lf |     <- строка запроса
| имя поля заголовка | sp | значение | cr | lf | < -\
|                                              | < - | - строки заголовка
| имя поля заголовка | sp | значение | cr | lf | < -/
| cr | lf |                                      <- пустая строка
|                                              | < -\
|                                              | < - | - тело сообщения
|                                              | < -/
```

## <a id="FTP" href="#FTP">FTP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используется для передачи файлов с одного хоста на другой хост через TCP. Использует в своей работе два соединения:
- **управляющее соединение** - для передачи контрольной информации между двумя хостами по порту 21 - **вне полосы** передачи файлов;
- **соединение данных** - для передачи файлов по порту 20.

Протокол общения:
- по порту 21 устанавливается управляющее соединение с серверной стороной;
- затем передается идентификатор и пароль пользователя через управляющее соединение;
- ведется обмен командами через управляющее соединение которое остается открытым в течение всего сеанса;
- для передачи файла сервер инициирует TCP-соединение данных с клиентской стороной по порту 20 и отправляет один файл по этому соединению и закрывает его.

### <a id="Команды" href="#Команды">Команды</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Команды состоят из 4 символов в верхнем регистре и необязательых параметров, а разделяются символом возврата каретки и переводом строки.

Основные команды:
- `USER <идентификатор_пользователя>` - передает идентификатор;
- `PASS <пароль_пользователя>` - передает пароль;
- `LIST` - запрашивает список всех файлов в текущем каталоге, при этом список передается через соединение данных;
- `RETR <имя_файла>` - запрашивает файл из текущего каталога, через соединение данных;
- `STOR <имя_файла>` - отправляет файл в текущий каталог, через соединение данных.

После каждой команды сервер отправляет ответ клиенту состоящий из трехзначного числа и необязательного сообщения.

## <a id="Электронная-почта" href="#Электронная-почта">Электронная почта</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Состоит из:
- **пользовательского агента** - который позволяет создавать, прочитывать сообщения, отвечать на них, перенаправлять и сохранять - он взаимодействует с почтовым сервером;
- **почтового сервера** - на котором хранится **почтовый ящик** пользователя;
- **простого протокола передачи почты** - Simple Mail Transfer Protocol (SMTP) использует TCP.

Основной путь сообщения:
1. Создание письма в пользовательском агенте;
2. Отправка сообщения на почтовый сервер отправителя, где оно помещается в очередь с интервалами отправок раз в 30 мин;
3. Передача сообщения из почтового сервера отправителя на почтовый сервер получателя посредством протокола SMTP и порта 25;
4. Помещение письма в почтовый ящик получателя.

Пример общения SMTP-клиента (К) и SMTP-сервера (С):
```
С: 220 hamburger.edu
К: HELO crepes.fr
С: 250 Hello crepes.fr, pleased to meet you
К: MAIL FROM: <alice@crepes.fr>
С: 250 alice@crepes.fr ... Sender ok
К: RCPT TO: <bob@hamburger.edu>
С: 250 bob@hamburger.edu ... Recipient ok
К: DATA
С: 354 Enter mail, end with "." on a line by itself
К: Вы любите кетчуп?
К: Как насчет анчоусов?
К: .
С: 250 Message accepted for delivery
К: QUIT
С: 221 hamburger.edu closing connection
```

Внутри секции передачи данных после команды `DATA` может распологатся секция заголовков в формате строк `<заголовок>: <значение>`, которая отделена от основных данных пустой строкой, данный оканчиваются строкой `.`.

На каждую команду сервер выдает ответ, сопровождающийся кодом ответа и некоторым (необязательным) англоязычным объяснением.

SMTP использует постоянные соединения: если сервер-источник пытается отправить несколько сообщений одному и тому же серверу-получателю, он может направить их все через одно TCP соединение.

Для доступа к почте используются протоколы, которые передают сообщения с почтового сервера на локальные устройства:
- **POP3** (Post Office Protocol, протокол почтового отделения, версия 3);
- **IMAP** (Internet Mail Access Protocol, протокол доступа к почте через Интернет);
- **HTTP**.

### <a id="POP3" href="#POP3">POP3</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Работает по порту 110. В процессе работы проходит 3 состояния:
1. Авторизация с помощью команд:
    - `user <идентификатор>`
    - `pass <пароль>`
2. Транзакции для получения сообщений, отметок сообщений о удалении, снятие отметок и получение статистики с помощью команд:
    - `list` - получения списка сообщений;
    - `retr <номер>` - получение сообщения по номеру;
    - `dele <номер>` - удаление сообщения по номеру;
3. Обновление данных - удаление помеченных сообщений на сервере, после команды `quit`.

На каждую команду сервер отвечает двумя возможными ответами:
- `+OK <сообщение>` - при успешной команде;
- `-ERR <сообщение>` - при неуспешной команде.

### <a id="IMAP" href="#IMAP">IMAP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Позволяет связывать каждое сообщение с определенным каталогом. А также позволяет пользовательскому агенту получать части сообщений, например, только заголовок, либо одну из частей MIME-сообщения.

## <a id="DNS" href="#DNS">DNS</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

DNS - это система доменных имен Интернета (Domain Name System). Это распределенная БД, которая реализована с помощью иерархии DNS-серверов и протокол, который общается посредством UDP и порта 53. Позволяет по имени хоста получить его IP-адрес.

Предоставляет службы:
- **назначение псевдонимов хостам** - это когда главному - **каноническому имени хоста** назначаются псевдонимы;
- **назначение псевдонимов почтовому серверу**;
- **распределение нагрузки** - это когда по имени хоста возвращается весь набор IP-адресов и с каждым ответом делает ротацию их порядка.

Существуют классы серверов DNS:
- **корневые DNS-серверы** - хранят список IP-адресов для DNS-серверов верхнего уровня;
- **DNS-серверы верхнего уровня** - отвечают за домены верхнего уровня (`org`, `net`, `edu`) и национальные домены верхнего уровня (`uk`, `fr`, `ca`, `jp`, `ru`) - хранят список IP-адресов для авторитетных DNS-серверов;
- **авторитетные DNS-серверы** (ответственные за свою зону `amazon.com`, `poly.edu`) - хранят список IP-адресов для хостов;
- **локальный DNS-сервер** - который находится у провайдера верхнего или нижнего уровня и производит общение с серверами выше для выяснения IP-адреса для хоста.

**Рекурсивный запрос** - это когда сервер получает информацию по поручению другого сервера, а **итеративный** - это когда сервер сам напрямую общается с другими серверами.

**DNS-кеширование** - это когда происходит кеширование записей на срок около 2 дней, для того чтобы уменьшить количество обращений на другие сервера.

Серверы DNS хранят **ресурсные записи** в виде набора из четырех полей:
- **имя** - зависит от типа;
- **значение** - зависит от типа;
- **тип**:
    - `A` - это запись преобразования имени в IP-адрес, где **имя** - имя хоста, а **значение** - IP-адрес хоста:
        > `(relay1.bar.foo.com, 145.37.93.126, A)`
    - `NS` - это запись соответствия значения домена и авторитетного сервера, где **имя** - домен, а **значение** - имя хоста авторитетного DNS-сервера, который отвечает за получение IP-адресов соответствующего домена:
        > `(foo.com, dns.foo.com, NS)`
    - `CNAME` - это запись соответствия канонического имени для псевдонима, где **имя** - псевдоним, а **значение** - каноническое имя:
        > `(foo.com, relay1.bar.foo.com, CNAME)`
    - `MX` - это запись соответствия канонического имени почтового сервера для псевдонима, где **имя** - псевдоним, а **значение** - каноническое имя почтового сервера:
        > `(foo.com, mail.bar.foo.com, MX)`
- **время жизни**

Если DNS-сервер не является авторитетным для какого-то определенного имени хоста, то он будет содержать запись типа `NS` для домена, который включает это имя хоста, а также запись типа `A`, в которой находится IP-адрес DNS-сервера, содержащегося в поле **значение** записи типа `NS`.

### <a id="DNS-сообщения" href="#DNS-сообщения">DNS сообщения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Используются для запросов и ответов и имеют одинаковый формат:
1. **Секция заголовков** - 12 байт:
    1. **Идентификатор запроса** - 16-разрядное число;
    2. **Флаги** - 16 бит:
        1. Однобитный флаг запрос / ответ:
            - `0` - запрос;
            - `1` - ответ.
        2. Однобитный флаг авторитетного ответа:
            - `0` - не является;
            - `1` - DNS сервер является авторитетным для запрашиваемого хоста.
        3. Однобитный флаг запроса рекурсии:
            - `0` - не требует;
            - `1` - требует от сервера обработать этот запрос самому.
        4. Однобитный флаг ответа возможности рекурсии:
            - `0` - не возможна;
            - `1` - рекурсия возможна.
    3. **Число вопросов** - 16-разрядное число;
    4. **Число ответных ресурсных записей** - 16-разрядное число;
    5. **Число ответных ресурсных записей авторитетного источника** - 16-разрядное число;
    6. **Число дополнительных ресурсных записей** - 16-разрядное число;
2. **Секция вопросов** - переменное количество - содержит информацию о выполняемом запросе, которая включает, поле имени, содержащее запрашиваемое имя хоста, и поле типа, которое указывает тип запроса: адрес, связанный с именем (тип А) или имя почтового сервера (тип MX);
3. **Секция ответов** - переменное количество - содержит ресурсные записи для запрашиваемых имен;
4. **Секция имен** - переменное количество - содержит ресурсные записи других авторитетных серверов;
5. **Секция дополнительной информации** - переменное количество - содержит другие полезные ресурсные записи.

## <a id="Одноранговые-приложения" href="#Одноранговые-приложения">Одноранговые приложения</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

### <a id="Протокол-для-передачи-файлов-BitTorrent" href="#Протокол-для-передачи-файлов-BitTorrent">Протокол для передачи файлов BitTorrent</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Набор всер пиров, участвующих в раздаче конкретного файла, называется **торрентом**. Пиры в торренте обмениваются друг с другом **кусками** (сегментами) файла равной длины - 256 кбит. Когда пир впервые присоединяется к торренту, он не имеет сегментов. С течением времени он собирает их больше и больше. Во время загрузки сегментов он может одновременно выгружать их, отдавая другим узлам.

Каждый торрент имеет инфраструктурный узел, называемый **трекером**. Когда пир присоединяется к торренту, он регистрируется на трекере и периодически информирует его о своем присутствии в раздаче. Трекер отслеживает пиров-участников торрента.

При присоединении к торренту, трекер случайным образом выбирает последовательность пиров (в районе 50 штук) из набора участвующих в раздаче и отправляет их IP-адреса. Обладая списком этих пиров, участник пытается установить параллельные TCP-соединения со всеми членами этого списка - соседями. Со временем количество узлов может изменяться - из него могут пропадать участники или добавляться.

В конкретный момент времени каждый пир имеет у себя определенный набор сегментов раздаваемого файла, а остальные пиры - другие наборы сегментов. Участник переодически запрашивает у своих соседей (через TCP-соединения) список сегментов, которыми они владеют. На основании этих списков будут запрашиваться (через TCP-соединения) сегменты, которых нет. Вначале запрашиваются **редкие сегменты** для того чтобы число копий каждого сегмента в торренте приблизительно уравнивалось.

Для обмена сегментами используется **алгоритм торговли** - для каждого из своих соседей участник постоянно измеряет скорость получения от них данных и определяет четырех пиров, которые снабжают его на самой высокой скорости, этот участник отвечает им взаимностью и отправляет сегменты этим четырем пирам - они становятся **разблокированными**. Каждые 10 секунд эти скорости пересчитываются, и, возможно, четверка лидирующих узлов меняется. Каждые 30 секунд участник случайным образом выбирает дополнительного соседа и отправляет ему сегменты файла, он становится **оптимистически разблокирован**. Все другие соседние пиры за пределами этой пятерки (четыре топ-узла и один случайный) **блокируются** (удушаются), то есть они не получают никаких сегментов от участника.

### <a id="Распределенные-хеш-таблицы-distributed-hash-table-DHT" href="#Распределенные-хеш-таблицы-distributed-hash-table-DHT">Распределенные хеш-таблицы (distributed hash table, DHT)</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

Каждый узел в системе распределенной БД будет хранить только небольшую часть всех пар ключ, значение. При этом каждый узел может запрос к системе с конкретным ключом, после чего та определяет узлы, которые содержат соответствующую пару ключ, значение и возвращает эту возвращает пару запрашивающему узлу. Также любой узел может добавлять новую пару ключ, значение в БД.

В основе лежит количество пользователей с идентификаторами в диапазоне `[0, 2^n - 1]` для некоторого фиксированного `n` и хеш функция, которая ставит в соответствие каждому ключу, целое число в диапазоне `[0, 2^n - 1]`.

При добавлении пары ключ, значение она добавляется в **ближайший следующий ключ** - пира, так как не всегда есть все пиры. Если ключ точно равен одному из идентификаторов, то сохраняют пару ключ, значение в узле с этим идентификатором; а если ключ больше чем все идентификаторы, то используют правило сохранения в узле с наименьшим идентификатором.

Для поиска используется кроуговое размещение пиров, в котором они знают информацию только о ближайших соседях и некоторых ссылок на другие узлы, это делается с помощью особого случая **оверлейной (наложенной) сети**, где узлы формируют логическую сеть, которая расположена как бы поверх компьютерной сети. Каналами связи в оверлейных сетях являются не физические, а виртуальные каналы между парами узлов. Каждый пир передает информацию соседям о поиске, если он не отвечает за этот идентификатор, а если отвечает, то отправляет сообщение обратно запрашивающему пиру что он отвечает за этот идентификатор.

Каждый пир переодически опрашивает своих соседий на то что они живы с помощью эхо-сообщений и проверкой ответа. В случае если он не отвечает, то он обновляет информацию о своих последователях, запрашивая информацию о последователях своих последователей.

При подключении пира к сети он опрашивает корневой идентификатор о том, кто является его последователем и предшественником, и это сообщение отправляется по сети в поисках пиров, которые являются последователсями и предшественниками. А затем менет их последователей и предшественников на себя.

<a id="Транспортный-уровень" href="#Транспортный-уровень">Транспортный уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
====================

Обеспечивает **логическое соединение** между прикладными процессами, выполняющимися на разных хостах - создание канала, непосредственно соединяющий процессы разных хостов. Обмениваются **сегментами**.

Основные протоколы:
- **UDP** (User Datagram Protocol, Протокол пользовательских дейтаграмм), который предоставляет ненадежную службу передачи данных без установления логического соединения для связи приложений.
- **TCP** (Transmission Control Protocol, протокол управления передачей), обеспечивающий службу надежной передачи данных с установлением соединения для связи между приложениями.

**Демультиплексирование** - это работа по доставке данных сегмента транспортного уровня нужному, соответствующему сокету на основании специальных полей сегмента.

**Мультиплексирование** - это сбор фрагментов данных, поступающих на транспортный уровень хоста-отправителя из различных сокетов, создание сегментов путем присоединения заголовка к каждому фрагменту и передача сегментов сетевому уровню.

**Специальные поля** сегментов - это 16-разрядные числа (0 - 65535): номер порта отправителя и номер порта получателся.

## <a id="UDP" href="#UDP">UDP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

UDP-сокет однозначно идентифицируется совокупностью IP-адреса хоста назначения и номера порта.

Если два UDP-сегмента имеют разные IP-адреса отправителя и/или номера портов отправителя, но одни и те же IP-адрес получателя и номер порта получателя, то оба сегмента будут направлены одному и тому же процессу получателя, использующему данный сокет.

## <a id="TCP" href="#TCP">TCP</a> [<a id="Содержание" href="#Содержание">Содержание</a>]

TCP-сокет однозначно идентифицируется совокупностью IP-адреса отправителя, номера порта отправителя, IP-адреса получателя и номера порта получателя.

Если два полученных TCP-сегмента будут иметь различные IP-адреса отправителя или номера портов отправителя, (исключая случай, когда TCP-сегмент содержит первичный запрос на установление соединения) то они будут направлены в два разных сокета.

<a id="Сетевой-уровень" href="#Сетевой-уровень">Сетевой уровень</a> [<a id="Содержание" href="#Содержание">Содержание</a>]
===============

Обеспечивает **логическое соединение** между хостами.